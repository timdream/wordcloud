/*! wordcloud-app  2014-11-15 */
var FACEBOOK_APP_ID="221493074531416",GOOGLE_CLIENT_ID="978080547219.apps.googleusercontent.com",IMGUR_CLIENT_ID="89b3cee0ba1b537",DONATE_HTML='<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank">  <input type="hidden" name="cmd" value="_s-xclick">  <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----MIIHLwYJKoZIhvcNAQcEoIIHIDCCBxwCAQExggEwMIIBLAIBADCBlDCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20CAQAwDQYJKoZIhvcNAQEBBQAEgYApgNc/KQPkXsONn7pwRFoID+QfTjZPt5iARTMrig/8BGwXEZ8O86unaR5xH5DKdFhrwBGRm5Ibr7p60phsVab0ZAXLrSBSEAK1AfxWtQzAYLtAbmsM1c9fDHVlidWThIL/HcUX2loOa/X5jYLuOy/4aIEnjj/9pUnCImIAchpL7TELMAkGBSsOAwIaBQAwgawGCSqGSIb3DQEHATAUBggqhkiG9w0DBwQIozjDTqCOFQWAgYiaWIwn8Ut10Es4W/1P4rwVUPXqFigIJxDuJINGNmKNV5/Zr7Pxt0f+woUNa2RbrNqowVqkFu2ZjHpg13rBkKzFS7C8lwGxDMat6XwDWnxhd+pdaQHo6ZD2rbbwb7knEUjxxc0FUYxO8mv5cXTTlyfjORb3zaP0Eq/NiSabeP7Txm9WdxCrO9VboIIDhzCCA4MwggLsoAMCAQICAQAwDQYJKoZIhvcNAQEFBQAwgY4xCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDQTEWMBQGA1UEBxMNTW91bnRhaW4gVmlldzEUMBIGA1UEChMLUGF5UGFsIEluYy4xEzARBgNVBAsUCmxpdmVfY2VydHMxETAPBgNVBAMUCGxpdmVfYXBpMRwwGgYJKoZIhvcNAQkBFg1yZUBwYXlwYWwuY29tMB4XDTA0MDIxMzEwMTMxNVoXDTM1MDIxMzEwMTMxNVowgY4xCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDQTEWMBQGA1UEBxMNTW91bnRhaW4gVmlldzEUMBIGA1UEChMLUGF5UGFsIEluYy4xEzARBgNVBAsUCmxpdmVfY2VydHMxETAPBgNVBAMUCGxpdmVfYXBpMRwwGgYJKoZIhvcNAQkBFg1yZUBwYXlwYWwuY29tMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDBR07d/ETMS1ycjtkpkvjXZe9k+6CieLuLsPumsJ7QC1odNz3sJiCbs2wC0nLE0uLGaEtXynIgRqIddYCHx88pb5HTXv4SZeuv0Rqq4+axW9PLAAATU8w04qqjaSXgbGLP3NmohqM6bV9kZZwZLR/klDaQGo1u9uDb9lr4Yn+rBQIDAQABo4HuMIHrMB0GA1UdDgQWBBSWn3y7xm8XvVk/UtcKG+wQ1mSUazCBuwYDVR0jBIGzMIGwgBSWn3y7xm8XvVk/UtcKG+wQ1mSUa6GBlKSBkTCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb22CAQAwDAYDVR0TBAUwAwEB/zANBgkqhkiG9w0BAQUFAAOBgQCBXzpWmoBa5e9fo6ujionW1hUhPkOBakTr3YCDjbYfvJEiv/2P+IobhOGJr85+XHhN0v4gUkEDI8r2/rNk1m0GA8HKddvTjyGw/XqXa+LSTlDYkqI8OwR8GEYj4efEtcRpRYBxV8KxAW93YDWzFGvruKnnLbDAF6VR5w/cCMn5hzGCAZowggGWAgEBMIGUMIGOMQswCQYDVQQGEwJVUzELMAkGA1UECBMCQ0ExFjAUBgNVBAcTDU1vdW50YWluIFZpZXcxFDASBgNVBAoTC1BheVBhbCBJbmMuMRMwEQYDVQQLFApsaXZlX2NlcnRzMREwDwYDVQQDFAhsaXZlX2FwaTEcMBoGCSqGSIb3DQEJARYNcmVAcGF5cGFsLmNvbQIBADAJBgUrDgMCGgUAoF0wGAYJKoZIhvcNAQkDMQsGCSqGSIb3DQEHATAcBgkqhkiG9w0BCQUxDxcNMTMwNjI1MTM0NzQxWjAjBgkqhkiG9w0BCQQxFgQU3kDruxd7qMkSyV1DI06NyIGmCXgwDQYJKoZIhvcNAQEBBQAEgYAV3gjHdsVXK3JTEj/IfC7e8hEoLnW6X94Xqmt6at4+qWAsrAfpkz9Eh+eAq+My8wRnmzGl91L2ytkJg6/zH+NWQZhbpTy7uUzgBynRICEDImrL+4Jab2quZmRv8RVRrKBu07DjgK/rpVfl4vIbtPQaanxI52YAMUMBIZD340m62g==-----END PKCS7-----">  <input type="image" src="https://www.paypalobjects.com/%lang/i/btn/btn_donate_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!"></form>';if(document.webL10n=function(window,document,undefined){function consoleLog(a){gDEBUG>=2&&console.log("[l10n] "+a)}function consoleWarn(a){gDEBUG&&console.warn("[l10n] "+a)}function getL10nResourceLinks(){return document.querySelectorAll('link[type="application/l10n"]')}function getL10nDictionary(){var a=document.querySelector('script[type="application/l10n"]');return a?JSON.parse(a.innerHTML):null}function getTranslatableChildren(a){return a?a.querySelectorAll("*[data-l10n-id]"):[]}function getL10nAttributes(a){if(!a)return{};var b=a.getAttribute("data-l10n-id"),c=a.getAttribute("data-l10n-args"),d={};if(c)try{d=JSON.parse(c)}catch(e){consoleWarn("could not parse arguments for #"+b)}return{id:b,args:d}}function fireL10nReadyEvent(a){var b=document.createEvent("Event");b.initEvent("localized",!0,!1),b.language=a,document.dispatchEvent(b)}function xhrLoadText(a,b,c,d){b=b||function(){},c=c||function(){consoleWarn(a+" not found.")};var e=new XMLHttpRequest;e.open("GET",a,d),e.overrideMimeType&&e.overrideMimeType("text/plain; charset=utf-8"),e.onreadystatechange=function(){4==e.readyState&&(200==e.status||0===e.status?b(e.responseText):c())},e.onerror=c,e.ontimeout=c;try{e.send(null)}catch(f){c()}}function parseResource(a,b,c,d){function e(a){return a.lastIndexOf("\\")<0?a:a.replace(/\\\\/g,"\\").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\t/g,"	").replace(/\\b/g,"\b").replace(/\\f/g,"\f").replace(/\\{/g,"{").replace(/\\}/g,"}").replace(/\\"/g,'"').replace(/\\'/g,"'")}function f(a){function c(a,c){for(var m=a.replace(h,"").split(/[\r\n]+/),n="*",o=b.replace(/-[a-z]+$/i,""),p=!1,q="",r=0;r<m.length;r++){var s=m[r];if(!i.test(s)){if(c){if(j.test(s)){q=j.exec(s),n=q[1],p="*"!==n&&n!==b&&n!==o;continue}if(p)continue;k.test(s)&&(q=k.exec(s),d(g+q[1]))}var t=s.match(l);t&&3==t.length&&(f[t[1]]=e(t[2]))}}}function d(a){xhrLoadText(a,function(a){c(a,!1)},null,!1)}var f=[],h=/^\s*|\s*$/,i=/^\s*#|^\s*$/,j=/^\s*\[(.*)\]\s*$/,k=/^\s*@import\s+url\((.*)\)\s*$/i,l=/^([^=\s]*)\s*=\s*(.+)$/;return c(a,!0),f}var g=a.replace(/[^\/]*$/,"")||"./";xhrLoadText(a,function(a){gTextData+=a;var b=f(a);for(var d in b){var e,g,h=d.lastIndexOf(".");h>0?(e=d.substring(0,h),g=d.substr(h+1)):(e=d,g=gTextProp),gL10nData[e]||(gL10nData[e]={}),gL10nData[e][g]=b[d]}c&&c()},d,gAsyncResourceLoading)}function loadLocale(a,b){function c(a){{var b=a.href;a.type}this.load=function(a,c){var d=a;return parseResource(b,a,c,function(){consoleWarn(b+" not found."),d=""}),d}}b=b||function(){},clear(),gLanguage=a=a.replace(/-[a-z]{2}$/i,function(a){return a.toUpperCase()});var d=getL10nResourceLinks(),e=d.length;if(0==e){var f=getL10nDictionary();return f&&f.locales&&f.default_locale?(consoleLog("using the embedded JSON directory, early way out"),gL10nData=f.locales[a]||f.locales[f.default_locale],b()):consoleLog("no resource to load, early way out"),fireL10nReadyEvent(a),void(gReadyState="complete")}var g=null,h=0;g=function(){h++,h>=e&&(b(),fireL10nReadyEvent(a),gReadyState="complete")};for(var i=0;e>i;i++){var j=new c(d[i]),k=j.load(a,g);k!=a&&(consoleWarn('"'+a+'" resource not found'),gLanguage="")}}function clear(){gL10nData={},gTextData="",gLanguage=""}function getPluralRules(a){function b(a,b){return-1!==b.indexOf(a)}function c(a,b,c){return a>=b&&c>=a}var d={af:3,ak:4,am:4,ar:1,asa:3,az:0,be:11,bem:3,bez:3,bg:3,bh:4,bm:0,bn:3,bo:0,br:20,brx:3,bs:11,ca:3,cgg:3,chr:3,cs:12,cy:17,da:3,de:3,dv:3,dz:0,ee:3,el:3,en:3,eo:3,es:3,et:3,eu:3,fa:0,ff:5,fi:3,fil:4,fo:3,fr:5,fur:3,fy:3,ga:8,gd:24,gl:3,gsw:3,gu:3,guw:4,gv:23,ha:3,haw:3,he:2,hi:4,hr:11,hu:0,id:0,ig:0,ii:0,is:3,it:3,iu:7,ja:0,jmc:3,jv:0,ka:0,kab:5,kaj:3,kcg:3,kde:0,kea:0,kk:3,kl:3,km:0,kn:0,ko:0,ksb:3,ksh:21,ku:3,kw:7,lag:18,lb:3,lg:3,ln:4,lo:0,lt:10,lv:6,mas:3,mg:4,mk:16,ml:3,mn:3,mo:9,mr:3,ms:0,mt:15,my:0,nah:3,naq:7,nb:3,nd:3,ne:3,nl:3,nn:3,no:3,nr:3,nso:4,ny:3,nyn:3,om:3,or:3,pa:3,pap:3,pl:13,ps:3,pt:3,rm:3,ro:9,rof:3,ru:11,rwk:3,sah:0,saq:3,se:7,seh:3,ses:0,sg:0,sh:11,shi:19,sk:12,sl:14,sma:7,smi:7,smj:7,smn:7,sms:7,sn:3,so:3,sq:3,sr:11,ss:3,ssy:3,st:3,sv:3,sw:3,syr:3,ta:3,te:3,teo:3,th:0,ti:4,tig:3,tk:3,tl:4,tn:3,to:0,tr:0,ts:3,tzm:22,uk:11,ur:3,ve:3,vi:0,vun:3,wa:4,wae:3,wo:0,xh:3,xog:3,yo:0,zh:0,zu:3},e={0:function(){return"other"},1:function(a){return c(a%100,3,10)?"few":0===a?"zero":c(a%100,11,99)?"many":2==a?"two":1==a?"one":"other"},2:function(a){return 0!==a&&a%10===0?"many":2==a?"two":1==a?"one":"other"},3:function(a){return 1==a?"one":"other"},4:function(a){return c(a,0,1)?"one":"other"},5:function(a){return c(a,0,2)&&2!=a?"one":"other"},6:function(a){return 0===a?"zero":a%10==1&&a%100!=11?"one":"other"},7:function(a){return 2==a?"two":1==a?"one":"other"},8:function(a){return c(a,3,6)?"few":c(a,7,10)?"many":2==a?"two":1==a?"one":"other"},9:function(a){return 0===a||1!=a&&c(a%100,1,19)?"few":1==a?"one":"other"},10:function(a){return c(a%10,2,9)&&!c(a%100,11,19)?"few":a%10!=1||c(a%100,11,19)?"other":"one"},11:function(a){return c(a%10,2,4)&&!c(a%100,12,14)?"few":a%10===0||c(a%10,5,9)||c(a%100,11,14)?"many":a%10==1&&a%100!=11?"one":"other"},12:function(a){return c(a,2,4)?"few":1==a?"one":"other"},13:function(a){return c(a%10,2,4)&&!c(a%100,12,14)?"few":1!=a&&c(a%10,0,1)||c(a%10,5,9)||c(a%100,12,14)?"many":1==a?"one":"other"},14:function(a){return c(a%100,3,4)?"few":a%100==2?"two":a%100==1?"one":"other"},15:function(a){return 0===a||c(a%100,2,10)?"few":c(a%100,11,19)?"many":1==a?"one":"other"},16:function(a){return a%10==1&&11!=a?"one":"other"},17:function(a){return 3==a?"few":0===a?"zero":6==a?"many":2==a?"two":1==a?"one":"other"},18:function(a){return 0===a?"zero":c(a,0,2)&&0!==a&&2!=a?"one":"other"},19:function(a){return c(a,2,10)?"few":c(a,0,1)?"one":"other"},20:function(a){return!c(a%10,3,4)&&a%10!=9||c(a%100,10,19)||c(a%100,70,79)||c(a%100,90,99)?a%1e6===0&&0!==a?"many":a%10!=2||b(a%100,[12,72,92])?a%10!=1||b(a%100,[11,71,91])?"other":"one":"two":"few"},21:function(a){return 0===a?"zero":1==a?"one":"other"},22:function(a){return c(a,0,1)||c(a,11,99)?"one":"other"},23:function(a){return c(a%10,1,2)||a%20===0?"one":"other"},24:function(a){return c(a,3,10)||c(a,13,19)?"few":b(a,[2,12])?"two":b(a,[1,11])?"one":"other"}},f=d[a.replace(/-.*$/,"")];return f in e?e[f]:(consoleWarn("plural form unknown for ["+a+"]"),function(){return"other"})}function getL10nData(a,b){var c=gL10nData[a];c||consoleWarn("#"+a+" is undefined.");var d={};for(var e in c){var f=c[e];f=substIndexes(f,b,a,e),f=substArguments(f,b,a),d[e]=f}return d}function substIndexes(a,b,c,d){var e=/\{\[\s*([a-zA-Z]+)\(([a-zA-Z]+)\)\s*\]\}/,f=e.exec(a);if(!f||!f.length)return a;var g,h=f[1],i=f[2];if(b&&i in b?g=b[i]:i in gL10nData&&(g=gL10nData[i]),h in gMacros){var j=gMacros[h];a=j(a,g,c,d)}return a}function substArguments(a,b,c){for(var d=/\{\{\s*(.+?)\s*\}\}/,e=d.exec(a);e;){if(!e||e.length<2)return a;var f=e[1],g="";if(b&&f in b)g=b[f];else{if(!(f in gL10nData))return consoleLog("argument {{"+f+"}} for #"+c+" is undefined."),a;g=gL10nData[f][gTextProp]}a=a.substring(0,e.index)+g+a.substr(e.index+e[0].length),e=d.exec(a)}return a}function translateElement(a){var b=getL10nAttributes(a);if(b.id){var c=getL10nData(b.id,b.args);if(!c)return void consoleWarn("#"+b.id+" is undefined.");if(c[gTextProp]){if(0===getChildElementCount(a))a[gTextProp]=c[gTextProp];else{for(var d=a.childNodes,e=!1,f=0,g=d.length;g>f;f++)3===d[f].nodeType&&/\S/.test(d[f].nodeValue)&&(e?d[f].nodeValue="":(d[f].nodeValue=c[gTextProp],e=!0));if(!e){var h=document.createTextNode(c[gTextProp]);a.insertBefore(h,a.firstChild)}}delete c[gTextProp]}for(var i in c)a[i]=c[i]}}function getChildElementCount(a){if(a.children)return a.children.length;if("undefined"!=typeof a.childElementCount)return a.childElementCount;for(var b=0,c=0;c<a.childNodes.length;c++)b+=1===a.nodeType?1:0;return b}function translateFragment(a){a=a||document.documentElement;for(var b=getTranslatableChildren(a),c=b.length,d=0;c>d;d++)translateElement(b[d]);translateElement(a)}function l10nStartup(){gReadyState="interactive";var a=navigator.language||navigator.userLanguage;consoleLog("loading ["+a+"] resources, "+(gAsyncResourceLoading?"asynchronously.":"synchronously.")),document.documentElement.lang===a?loadLocale(a):loadLocale(a,translateFragment)}var gL10nData={},gTextData="",gTextProp="textContent",gLanguage="",gMacros={},gReadyState="loading",gAsyncResourceLoading=!0,gDEBUG=1;return gMacros.plural=function(a,b,c,d){var e=parseFloat(b);if(isNaN(e))return a;if(d!=gTextProp)return a;gMacros._pluralRules||(gMacros._pluralRules=getPluralRules(gLanguage));var f="["+gMacros._pluralRules(e)+"]";return 0===e&&c+"[zero]"in gL10nData?a=gL10nData[c+"[zero]"][d]:1==e&&c+"[one]"in gL10nData?a=gL10nData[c+"[one]"][d]:2==e&&c+"[two]"in gL10nData?a=gL10nData[c+"[two]"][d]:c+f in gL10nData?a=gL10nData[c+f][d]:c+"[other]"in gL10nData&&(a=gL10nData[c+"[other]"][d]),a},document.addEventListener?"loading"===document.readyState?document.addEventListener("DOMContentLoaded",l10nStartup):window.setTimeout(l10nStartup):window.attachEvent&&(window.console||(consoleLog=consoleWarn=function(){}),window.XMLHttpRequest||(xhrLoadText=function(a,b,c,d){b=b||function(){},c=c||function(){consoleWarn(a+" not found.")};var e=new ActiveXObject("Microsoft.XMLHTTP");e.open("GET",a,d),e.onreadystatechange=function(){4==e.readyState&&(200==e.status?b(e.responseText):c())},e.send(null)}),window.JSON||(getL10nAttributes=function(element){if(!element)return{};var l10nId=element.getAttribute("data-l10n-id"),l10nArgs=element.getAttribute("data-l10n-args"),args={};if(l10nArgs)try{args=eval(l10nArgs)}catch(e){consoleWarn("could not parse arguments for #"+l10nId)}return{id:l10nId,args:args}}),document.querySelectorAll||(getTranslatableChildren=function(a){if(!a)return[];for(var b=a.getElementsByTagName("*"),c=[],d=b.length,e=0;d>e;e++)b[e].getAttribute("data-l10n-id")&&c.push(b[e]);return c},getL10nResourceLinks=function(){for(var a=document.getElementsByTagName("link"),b=[],c=a.length,d=0;c>d;d++)"application/l10n"==a[d].type&&b.push(a[d]);return b}),window.JSON&&document.querySelectorAll||(getL10nDictionary=function(){for(var scripts=document.getElementsByName("script"),i=0;i<scripts.length;i++)if("application/l10n"==scripts[i].type)return eval(scripts[i].innerHTML);return null}),document.createEventObject&&!document.createEvent&&(fireL10nReadyEvent=function(){document.documentElement.localized=1}),window.attachEvent("onload",function(){gTextProp=document.body.textContent?"textContent":"innerText",l10nStartup()})),{get:function(a,b,c){var d=getL10nData(a,b)||c;return d?gTextProp in d?d[gTextProp]:"":"{{"+a+"}}"},getData:function(){return gL10nData},getText:function(){return gTextData},getLanguage:function(){return gLanguage},setLanguage:function(a){loadLocale(a,translateFragment)},getDirection:function(){var a=["ar","he","fa","ps","ur"];return a.indexOf(gLanguage)>=0?"rtl":"ltr"},translate:translateFragment,getReadyState:function(){return gReadyState},ready:function(a){a&&("complete"==gReadyState||"interactive"==gReadyState?window.setTimeout(a):document.addEventListener?document.addEventListener("localized",a):document.attachEvent&&document.documentElement.attachEvent("onpropertychange",function(b){"localized"===b.propertyName&&a()}))}}}(window,document),void 0===window._)var _=document.webL10n.get;!function(a){var b=function(a){var b={};a=a||{},a.workerUrl=a.workerUrl||"wordfreq.worker.js";var c,d=[],e=null,f=!1,g=function(a){d.push(a),e||h()},h=function(){e=d.shift(),c.postMessage({method:e.method,params:e.params}),delete e.method,delete e.params},i=function(a){var c=e.callback;e=null,c&&c.call(b,a.data),d.length&&h()},j=function(a){var c=e.callback;delete e.callback,c&&c.call(b,a.data),e=null,d.length&&h()},k=["process","empty","getList","getLength","getVolume"];k.forEach(function(a){b[a]=function(){if(!f){var c,d=arguments.length;"function"==typeof arguments[arguments.length-1]&&(c=arguments[arguments.length-1],d--);for(var e=[],h=0;d>h;)e[h]=arguments[h],h++;return g({method:a,params:e,callback:c}),b}}});var l=function(){f=!0,c.terminate(),c.onmessage=null,c.onerror=null,c=null};b.stop=function(a){if(!f){if(l(),!a)return e=null,d=[],b;for(e&&e.callback&&e.callback.call(b),e=null;d.length;){var c=d.shift();c.callback&&c.callback.call(b)}return b}};var m=function(){c=new Worker(a.workerUrl),c.onmessage=i,c.onerror=j,g({method:"init",params:[a]})};return m(),b};b.isSupported=!!(a.Worker&&Array.prototype.push&&Array.prototype.indexOf&&Array.prototype.forEach&&Array.isArray&&Object.create),"function"==typeof define&&define.amd?define("wordfreq",[],function(){return b}):a.WordFreq=b}(this),window.setImmediate||(window.setImmediate=function(){return window.msSetImmediate||window.webkitSetImmediate||window.mozSetImmediate||window.oSetImmediate||function(){if(!window.postMessage||!window.addEventListener)return null;var a=[void 0],b="zero-timeout-message",c=function(c){var d=a.length;return a.push(c),window.postMessage(b+d.toString(36),"*"),d};return window.addEventListener("message",function(c){if("string"==typeof c.data&&c.data.substr(0,b.length)===b){c.stopImmediatePropagation();var d=parseInt(c.data.substr(b.length),36);a[d]&&(a[d](),a[d]=void 0)}},!0),window.clearImmediate=function(b){a[b]&&(a[b]=void 0)},c}()||function(a){window.setTimeout(a,0)}}()),window.clearImmediate||(window.clearImmediate=function(){return window.msClearImmediate||window.webkitClearImmediate||window.mozClearImmediate||window.oClearImmediate||function(a){window.clearTimeout(a)}}()),function(a){var b=function(){var a=document.createElement("canvas");if(!a||!a.getContext)return!1;var b=a.getContext("2d");return b.getImageData&&b.fillText&&Array.prototype.some&&Array.prototype.push?!0:!1}(),c=function(){if(b){for(var a,c,d=document.createElement("canvas").getContext("2d"),e=20;e;){if(d.font=e.toString(10)+"px sans-serif",d.measureText("Ｗ").width===a&&d.measureText("m").width===c)return e+1;a=d.measureText("Ｗ").width,c=d.measureText("m").width,e--}return 0}}(),d=function(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a},e=function(a,e){if(b){"string"==typeof a&&(a=document.getElementById(a));var f={list:[],fontFamily:'"Trebuchet MS", "Heiti TC", "微軟正黑體", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',color:"random-dark",minSize:0,weightFactor:1,clearCanvas:!0,backgroundColor:"#fff",gridSize:8,origin:null,drawMask:!1,maskColor:"rgba(255,0,0,0.3)",maskGapWidth:.3,wait:0,abortThreshold:0,abort:function(){},minRotation:-Math.PI/2,maxRotation:Math.PI/2,shuffle:!0,rotateRatio:.1,shape:"circle",ellipticity:.65,hover:null,click:null};if(e)for(var g in e)g in f&&(f[g]=e[g]);if("function"!=typeof f.weightFactor){var h=f.weightFactor;f.weightFactor=function(a){return a*h}}if("function"!=typeof f.shape)switch(f.shape){case"circle":default:f.shape="circle";break;case"cardioid":f.shape=function(a){return 1-Math.sin(a)};break;case"diamond":case"square":f.shape=function(a){var b=a%(2*Math.PI/4);return 1/(Math.cos(b)+Math.sin(b))};break;case"triangle-forward":f.shape=function(a){var b=a%(2*Math.PI/3);return 1/(Math.cos(b)+Math.sqrt(3)*Math.sin(b))};break;case"triangle":case"triangle-upright":f.shape=function(a){var b=(a+3*Math.PI/2)%(2*Math.PI/3);return 1/(Math.cos(b)+Math.sqrt(3)*Math.sin(b))};break;case"pentagon":f.shape=function(a){var b=(a+.955)%(2*Math.PI/5);return 1/(Math.cos(b)+.726543*Math.sin(b))};break;case"star":f.shape=function(a){var b=(a+.955)%(2*Math.PI/10);return(a+.955)%(2*Math.PI/5)-2*Math.PI/10>=0?1/(Math.cos(2*Math.PI/10-b)+3.07768*Math.sin(2*Math.PI/10-b)):1/(Math.cos(b)+3.07768*Math.sin(b))}}f.gridSize=Math.max(f.gridSize,4);var i,j,k,l,m,n,o,p,q=f.gridSize,r=q-f.maskGapWidth,s=Math.abs(f.maxRotation-f.minRotation),t=Math.min(f.maxRotation,f.minRotation);switch(f.color){case"random-dark":p=function(){return"rgb("+Math.floor(128*Math.random()).toString(10)+","+Math.floor(128*Math.random()).toString(10)+","+Math.floor(128*Math.random()).toString(10)+")"};break;case"random-light":p=function(){return"rgb("+Math.floor(128*Math.random()+128).toString(10)+","+Math.floor(128*Math.random()+128).toString(10)+","+Math.floor(128*Math.random()+128).toString(10)+")"};break;default:"function"==typeof f.color&&(p=f.color)}var u,v=!1,w=[],x=function(b){var c=a.getBoundingClientRect(),d=b.clientX-c.left,e=b.clientY-c.top,f=Math.floor(d*(a.width/c.width)/q),g=Math.floor(e*(a.height/c.height)/q);return w[f][g]},y=function(a){var b=x(a);if(u!==b)return u=b,b?void f.hover(b.item,b.dimension,a):void f.hover(void 0,void 0,a)},z=function(a){var b=x(a);b&&f.click(b.item,b.dimension,a)},A=[],B=function(a){if(A[a])return A[a];var b=8*a,c=b,d=[];for(0===a&&d.push([m[0],m[1],0]);c--;){var e=1;"circle"!==f.shape&&(e=f.shape(c/b*2*Math.PI)),d.push([m[0]+a*e*Math.cos(-c/b*2*Math.PI),m[1]+a*e*Math.sin(-c/b*2*Math.PI)*f.ellipticity,c/b*2*Math.PI])}return A[a]=d,d},C=function(){return f.abortThreshold>0&&(new Date).getTime()-o>f.abortThreshold},D=function(){return 0===f.rotateRatio?0:Math.random()>f.rotateRatio?0:0===s?t:t+Math.random()*s},E=function(a,b,d){var e=!1,g=f.weightFactor(b);if(g<=f.minSize)return!1;var h=1;c>g&&(h=function(){for(var a=2;c>a*g;)a+=2;return a}());var i=document.createElement("canvas"),j=i.getContext("2d");j.font=(g*h).toString(10)+"px "+f.fontFamily;var k=j.measureText(a).width/h,l=Math.max(g*h,j.measureText("m").width,j.measureText("Ｗ").width)/h,m=k+2*l,n=3*l,o=Math.ceil(m/q),p=Math.ceil(n/q);m=o*q,n=p*q;var r=-k/2,s=.35*l,t=Math.ceil((m*Math.abs(Math.sin(d))+n*Math.abs(Math.cos(d)))/q),u=Math.ceil((m*Math.abs(Math.cos(d))+n*Math.abs(Math.sin(d)))/q),v=u*q,w=t*q;i.setAttribute("width",v),i.setAttribute("height",w),e&&document.body.appendChild(i),j.save(),j.scale(1/h,1/h),j.translate(v*h/2,w*h/2),j.rotate(-d),j.font=(g*h).toString(10)+"px "+f.fontFamily,j.fillStyle="#000",j.textBaseline="alphabetic",j.fillText(a,r*h,s*h),j.restore();var x=j.getImageData(0,0,v,w).data;if(C())return!1;for(var y,z,A,B=[],D=u,E=[t/2,u/2,t/2,u/2];D--;)for(y=t;y--;){A=q;a:{for(;A--;)for(z=q;z--;)if(x[4*((y*q+A)*v+(D*q+z))+3]){B.push([D,y]),D<E[3]&&(E[3]=D),D>E[1]&&(E[1]=D),y<E[0]&&(E[0]=y),y>E[2]&&(E[2]=y),e&&(j.fillStyle="rgba(255, 0, 0, 0.5)",j.fillRect(D*q,y*q,q-.5,q-.5));break a}e&&(j.fillStyle="rgba(0, 0, 255, 0.5)",j.fillRect(D*q,y*q,q-.5,q-.5))}}return e&&(j.fillStyle="rgba(0, 255, 0, 0.5)",j.fillRect(E[3]*q,E[0]*q,(E[1]-E[3]+1)*q,(E[2]-E[0]+1)*q)),{mu:h,occupied:B,bounds:E,gw:u,gh:t,fillTextOffsetX:r,fillTextOffsetY:s,fontSize:g}},F=function(a,b,c,d,e){for(var f=e.length;f--;){var g=a+e[f][0],h=b+e[f][1];if(g>=k||h>=l||0>g||0>h||!j[g][h])return!1}return!0},G=function(a,b,c,d,e,g,h,j){var k=c.fontSize,l=c.mu;i.save(),i.scale(1/l,1/l),i.font=(k*l).toString(10)+"px "+f.fontFamily,i.fillStyle=p?p(d,e,k,g,h):f.color,i.textBaseline="alphabetic",i.translate((a+c.gw/2)*q*l,(b+c.gh/2)*q*l),0!==j&&i.rotate(-j),i.fillText(d,c.fillTextOffsetX*l,c.fillTextOffsetY*l),i.restore()},H=function(a,b,c,d,e){a>=k||b>=l||0>a||0>b||(j[a][b]=!1,c&&i.fillRect(a*q,b*q,r,r),v&&(w[a][b]={item:e,dimension:d}))},I=function(a,b,c,d,e,g){var h=e.occupied,j=(q-f.maskGapWidth,f.drawMask);j&&(i.save(),i.fillStyle=f.maskColor);var k;if(v){var l=e.bounds;k={x:(a+l[3])*q,y:(b+l[0])*q,w:(l[1]-l[3]+1)*q,h:(l[2]-l[0]+1)*q}}for(var m=h.length;m--;)H(a+h[m][0],b+h[m][1],j,k,g);j&&i.restore()},J=function(a){var b=a[0],c=a[1],e=D(),g=E(b,c,e);if(!g)return!1;if(C())return!1;var h=g.bounds;if(h[1]-h[3]+1>k||h[2]-h[0]+1>l)return!1;for(var i=n+1;i--;){var j=B(n-i);f.shuffle&&(j=[].concat(j),d(j));var m=j.some(function(d){var f=Math.floor(d[0]-g.gw/2),h=Math.floor(d[1]-g.gh/2),j=g.gw,k=g.gh;return F(f,h,j,k,g.occupied)?(G(f,h,g,b,c,n-i,d[2],e),I(f,h,j,k,g,a),!0):!1});if(m)return!0}return!1},K=function(a,b,c,d){var e=document.createEvent("CustomEvent");return e.initCustomEvent(b,!0,c,d||{}),a.dispatchEvent(e)},L=function(a){if(K(a,"wordcloudstart",!0)){if(k=Math.floor(a.width/q),l=Math.floor(a.height/q),i=a.getContext("2d"),m=f.origin?[f.origin[0]/q,f.origin[1]/q]:[k/2,l/2],n=Math.floor(Math.sqrt(k*k+l*l)),j=[],f.clearCanvas){i.fillStyle=f.backgroundColor,i.clearRect(0,0,k*(q+1),l*(q+1)),i.fillRect(0,0,k*(q+1),l*(q+1));for(var b,c=k;c--;)for(j[c]=[],b=l;b--;)j[c][b]=!0}else{var d=document.createElement("canvas").getContext("2d");d.fillStyle=f.backgroundColor,d.fillRect(0,0,1,1);for(var b,e,g,h,p=d.getImageData(0,0,1,1).data,r=i.getImageData(0,0,k*q,l*q).data,c=k;c--;)for(j[c]=[],b=l;b--;){g=q;a:for(;g--;)for(e=q;e--;)for(h=4;h--;)if(r[4*((b*q+g)*k*q+(c*q+e))+h]!==p[h]){j[c][b]=!1;break a}j[c][b]!==!1&&(j[c][b]=!0)}r=d=p=void 0}if(f.hover||f.click){v=!0;for(var c=k+1;c--;)w[c]=[];f.hover&&a.addEventListener("mousemove",y),f.click&&a.addEventListener("click",z),a.addEventListener("wordcloudstart",function B(){a.removeEventListener("wordcloudstart",B),a.removeEventListener("mousemove",y),a.removeEventListener("click",z),u=void 0})}var s,t,h=0;0!==f.wait?(s=window.setTimeout,t=window.clearTimeout):(s=window.setImmediate,t=window.clearImmediate);var x=function D(){a.removeEventListener("wordcloudstart",D),t(A)};a.addEventListener("wordcloudstart",x);var A=s(function E(){if(h>=f.list.length)return t(A),K(a,"wordcloudstop",!1),void a.removeEventListener("wordcloudstart",x);o=(new Date).getTime();var b=J(f.list[h]),c=!K(a,"wordclouddrawn",!0,{item:f.list[h],drawn:b});return C()||c?(t(A),f.abort(),K(a,"wordcloudabort",!1),K(a,"wordcloudstop",!1),void a.removeEventListener("wordcloudstart",x)):(h++,void(A=s(E,f.wait)))},f.wait)}};L(a)}};e.isSupported=b,e.miniumFontSize=c,"function"==typeof define&&define.amd?define("wordcloud",[],function(){return e}):a.WordCloud=e}(this);var WordCloudApp=function(){if(!((window.WordFreq&&window.WordFreq.isSupported||window.WordFreqSync&&window.WordFreqSync.isSupported)&&WordCloud.isSupported&&Object.keys&&Array.prototype.map&&Array.prototype.forEach&&Array.prototype.indexOf&&Function.prototype.bind&&"onhashchange"in window))return window.onload=function(){var a=document.getElementById("wc-browser-support");try{delete a.hidden}catch(b){}a.removeAttribute&&a.removeAttribute("hidden")},this.isSupported=!1,void this.logAction("WordCloudApp::isSupported::false");this.isSupported=!0,this.logAction("WordCloudApp::isSupported::true"),this.isFullySupported=function(){if(!FilePanelView.prototype.isSupported)return!1;if(window.HTMLCanvasElement.prototype.toBlob)return!0;var a=window.Blob&&function(){try{return Boolean(new Blob)}catch(a){return!1}}(),b=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;return!!((a||b)&&window.atob&&window.ArrayBuffer&&window.Uint8Array)}(),this.logAction("WordCloudApp::isFullySupported::"+this.isFullySupported),window.addEventListener("load",this),this.fetchers={},this.views={},this.currentUIState=this.UI_STATE_LOADING,this.UIStateViewMap=[["loading"],["canvas","source-dialog"],["loading","dashboard"],["canvas","dashboard"],["canvas","dashboard","list-dialog"],["loading","dashboard"],["canvas","dashboard","sharer-dialog"],["canvas","about-dialog"]],this.wordfreqOption={workerUrl:"./assets/wordfreq/src/wordfreq.worker.js?_=i2hqie3e"},this.shapes=[{shape:"circle"},{shape:function(a){var b=(a+Math.PI/4)%(2*Math.PI/4);return 1/(Math.cos(b)+Math.sin(b))}},{shape:"triangle-forward",ellipticity:1},{shape:"star",ellipticity:1}];var a='"Trebuchet MS", "Heiti TC", "微軟正黑體", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',b='Baskerville, "Times New Roman", "華康儷金黑 Std", "華康儷宋 Std",  DFLiKingHeiStd-W8, DFLiSongStd-W5, "Hiragino Mincho Pro", "LiSong Pro Light", "新細明體", serif',c=function(a){return function(){return a[Math.floor(Math.random()*a.length)]}};this.themes=[{fontFamily:b,color:c(["#66d9ef","#a6e22d","#fd9720","#a6e22a","#a581ff","#f92772"]),backgroundColor:"#272822"},{fontFamily:a,color:c(["#07ABDA","#63D6F6","#0F7BDC","#69B4F7","#00DBB6","#376F65","#004438","#5FF7DD"]),backgroundColor:"#AAF7EA"},{fontFamily:b,color:c(["#2F55D1","#4058A5","#133193","#98AFFD"]),backgroundColor:"#e3e9fd"},{fontFamily:a,color:c(["#c30000","#c37a00","#650281","#de3333","#de5c5c","#7e602c","#633e00","#481e53"]),backgroundColor:"#edd1a4"},{fontFamily:a,color:function(){return"rgb("+Math.floor(128*Math.random()+48).toString(10)+","+Math.floor(128*Math.random()+48).toString(10)+","+Math.floor(128*Math.random()+48).toString(10)+")"},backgroundColor:"#eee"},{fontFamily:b,color:"random-light",backgroundColor:"#000"},{fontFamily:b,color:c(["#3a3f42","#575d51","#42361d"]),backgroundColor:"#8d8380"},{fontFamily:b,color:c(["#f7e4be","#f0f4bc","#9a80a4","#848da6"]),backgroundColor:"#223564"},{fontFamily:b,color:"#d0d0d0",backgroundColor:"#999"},{fontFamily:a,color:"rgba(255,255,255,0.8)",backgroundColor:"#353130"},{fontFamily:a,color:"rgba(0,0,0,0.7)",backgroundColor:"rgba(255, 255, 255, 1)"}],this.data={theme:0,shape:0,gridSize:void 0,weightFactor:void 0}};WordCloudApp.prototype.addView=function(a){this.views[a.name]=a,a.app=this},WordCloudApp.prototype.addFetcher=function(a){a.types.forEach(function(b){this.fetchers[b]=a}.bind(this)),a.app=this},WordCloudApp.prototype.pushUrlHash=function(a){if(a===window.location.hash)return this.route(),!0;this.backToReset=!window.location.hash.substr(1),this.lastUrlHashChangePushedByScript=!0;try{window.location.hash=a}catch(b){return!1}return!0},WordCloudApp.prototype.reset=function(){window.location.hash.substr(1)&&(this.backToReset?window.history.back():this.pushUrlHash(""))},WordCloudApp.prototype.UI_STATE_LOADING=0,WordCloudApp.prototype.UI_STATE_SOURCE_DIALOG=1,WordCloudApp.prototype.UI_STATE_WORKING=2,WordCloudApp.prototype.UI_STATE_DASHBOARD=3,WordCloudApp.prototype.UI_STATE_LIST_DIALOG=4,WordCloudApp.prototype.UI_STATE_ERROR_WITH_DASHBOARD=5,WordCloudApp.prototype.UI_STATE_SHARER_DIALOG=6,WordCloudApp.prototype.UI_STATE_ABOUT_DIALOG=7,WordCloudApp.prototype.switchUIState=function(a){if(!this.UIStateViewMap[a])throw"Undefined state "+a;document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur();var b=Object.keys(this.views),c=this.currentUIState;b.forEach(function(b){this.views[b][-1!==this.UIStateViewMap[a].indexOf(b)?"show":"hide"](c,a)}.bind(this)),this.currentUIState=a},WordCloudApp.prototype.handleData=function(a,b){if(this.logAction("WordCloudApp::handleData",b+" ("+a.length+")"),!a.length)return this.switchUIState(this.UI_STATE_ERROR_WITH_DASHBOARD),void this.views.loading.updateLabel(this.views.loading.LABEL_ERROR_DATA);this.currentFetcher=void 0,this.views.loading.updateLabel(this.views.loading.LABEL_ANALYZING),this.data.title=b;var c;this.wordfreq=WordFreq?WordFreq(this.wordfreqOption).process(a).getVolume(function(a){c=a}).getList(function(a){this.wordfreq=void 0,this.handleList(a,c)}.bind(this)):setTimeout(function(){var b=WordFreqSync(this.wordfreqOption),c=b.process(a),d=b.getVolume();this.wordfreq=void 0,this.handleList(c,d)}.bind(this))},WordCloudApp.prototype.stopHandleData=function(){this.wordfreq&&("object"==typeof this.wordfreq?this.wordfreq.stop(!1):clearTimeout(this.wordfreq),this.wordfreq=void 0)},WordCloudApp.prototype.handleList=function(a,b){return this.logAction("WordCloudApp::handleList",a.length),a.length?(this.switchUIState(this.UI_STATE_DASHBOARD),this.data.list=a,this.data.gridSize=4,this.data.theme=Math.floor(Math.random()*this.themes.length),this.calculateWeightFactor(b),void this.draw()):(this.switchUIState(this.UI_STATE_ERROR_WITH_DASHBOARD),void this.views.loading.updateLabel(this.views.loading.LABEL_ERROR_LIST))},WordCloudApp.prototype.draw=function(){var a=this.views.canvas;a.setDimension(),a.draw(this.getWordCloudOption());var b=this.parseHash();this.logAction("WordCloudApp::draw::"+b[0],b[1].substr(0,128))},WordCloudApp.prototype.getCanvasElement=function(){return this.views.canvas.canvasElement},WordCloudApp.prototype.calculateWeightFactor=function(a){var b=this.views.canvas.documentWidth,c=this.views.canvas.documentHeight;this.data.weightFactor=Math.sqrt(b*c/a)},WordCloudApp.prototype.getWordCloudOption=function(){var a={},b=Object.keys(this.data);b.forEach(function(b){a[b]=this.data[b]}.bind(this));var c=Object.keys(this.themes[this.data.theme]);c.forEach(function(b){a[b]=this.themes[this.data.theme][b]}.bind(this));var d=Object.keys(this.shapes[this.data.shape]);return d.forEach(function(b){a[b]=this.shapes[this.data.shape][b]}.bind(this)),a},WordCloudApp.prototype.showSharer=function(){this.switchUIState(this.UI_STATE_SHARER_DIALOG)},WordCloudApp.prototype.route=function(){var a=window.location.hash.substr(1);if(this.backToReset&&!this.lastUrlHashChangePushedByScript&&(this.backToReset=!1),this.lastUrlHashChangePushedByScript=!1,this.currentFetcher&&(this.currentFetcher.stop(),this.currentFetcher=void 0),this.stopHandleData(),!a)return this.switchUIState(this.UI_STATE_SOURCE_DIALOG),void this.logAction("WordCloudApp::route::source-dialog");var b=this.parseHash(),c=b[0],d=b[1];b=void 0,this.logAction("WordCloudApp::route::"+c,d.substr(0,128));var e=-1===c.indexOf(".")?c:c.split(".")[0];if(e in this.fetchers){this.switchUIState(this.UI_STATE_WORKING);
var f=this.currentFetcher=this.fetchers[e];this.views.loading.updateLabel(f.LABEL_VERB),f.getData(c,d)}else this.reset()},WordCloudApp.prototype.logAction=function(a,b,c){if(window._gaq){var d=["_trackEvent","Word Cloud"];void 0!==a&&(d.push(a.toString()),void 0!==b&&(d.push(b.toString()),void 0!==c&&d.push(parseFloat(c,10)))),window._gaq.push(d)}},WordCloudApp.prototype.parseHash=function(){var a,b,c=window.location.hash.substr(1);return c.match(/^([^:]+):?(.*)$/).forEach(function(c,d){switch(d){case 1:a=c;break;case 2:b=c}}),[a,b]},WordCloudApp.prototype.handleEvent=function(a){switch(a.type){case"load":window.removeEventListener("load",this),window.addEventListener("hashchange",this),this.route();break;case"hashchange":this.route()}},WordCloudApp.prototype.uninit=function(){window.removeEventListener("load",this),window.removeEventListener("hashchange",this)};var FacebookSDKLoader=function(){if(!FACEBOOK_APP_ID)throw"No FACEBOOK_APP_ID defined.";this.loaded=!1};FacebookSDKLoader.prototype.load=function(a){if(this.loaded)throw"FacebookSDKLoader shouldn't be reused.";if(this.loaded=!0,window.FB)return void a();if(window.fbAsyncInit){var b=window.fbAsyncInit;return void(window.fbAsyncInit=function(){window.fbAsyncInit=null,b(),a()}.bind(this))}var c=document.createElement("div");c.id="fb-root",document.body.insertBefore(c,document.body.firstChild),function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/en_US/all.js",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk");var d=window.FACEBOOK_CHANNEL_URL||document.location.href.replace(/\/(index.html)?(#.*)?$/i,"/facebook-channel.html");window.fbAsyncInit=function(){window.fbAsyncInit=null,FB.init({appId:FACEBOOK_APP_ID,channelUrl:d}),a()}};var View=function(){};View.prototype.load=function(a,b){a=a||{};for(var c in b){if(c in this)break;this[c]=c in a?a[c]:b[c],("element"===c||/Element$/.test(c))&&(this[c]="string"==typeof this[c]?document.getElementById(this[c]):this[c])}},View.prototype.show=function(){return"beforeShow"in this&&this.beforeShow.apply(this,arguments)===!1?!1:(this.element.removeAttribute("hidden"),"afterShow"in this&&this.afterShow.apply(this,arguments),!0)},View.prototype.hide=function(){return"beforeHide"in this&&this.beforeHide.apply(this,arguments)===!1?!1:(this.element.setAttribute("hidden",!0),"afterHide"in this&&this.afterHide.apply(this,arguments),!0)};var LanguageSwitcherView=function(a){this.load(a,{element:"wc-language"});var b=navigator.language||navigator.userLanguage;b=b.replace(/-[a-z]{2}$/i,function(a){return a.toUpperCase()});var c=this.langs=[];Array.prototype.forEach.call(this.element.children,function(a){c.push(a.value),a.value===b&&(a.selected=!0)}),-1===c.indexOf(b)&&(this.element.selectedIndex=0),document.addEventListener("localized",this),this.element.addEventListener("change",this)};LanguageSwitcherView.prototype=new View,LanguageSwitcherView.prototype.handleEvent=function(a){switch(a.type){case"change":document.webL10n.setLanguage(this.element.value),this.app.logAction("LanguageSwitcherView::change",this.element.value);break;case"localized":this.app.logAction("LanguageSwitcherView::localized",document.documentElement.lang)}};var LoadingView=function(a){this.load(a,{name:"loading",element:"wc-loading",labelElement:"wc-loading-label"}),this.stringIds=["downloading","loading","analyzing","no_data","no_list_output"]};LoadingView.prototype=new View,LoadingView.prototype.LABEL_DOWNLOADING=0,LoadingView.prototype.LABEL_LOADING=1,LoadingView.prototype.LABEL_ANALYZING=2,LoadingView.prototype.LABEL_ERROR_DATA=3,LoadingView.prototype.LABEL_ERROR_LIST=4,LoadingView.prototype.beforeShow=function(a,b){this.element.className=b===this.app.UI_STATE_ERROR_WITH_DASHBOARD?"error":""},LoadingView.prototype.updateLabel=function(a){if(!this.stringIds[a])throw"Undefined stringId "+a;this.labelElement.setAttribute("data-l10n-id",this.stringIds[a]),__(this.labelElement)};var ListDialogView=function(a){this.load(a,{name:"list-dialog",element:"wc-list-dialog",textElement:"wc-list-edit",cancelBtnElement:"wc-list-cancel-btn",confirmBtnElement:"wc-list-confirm-btn"}),this.cancelBtnElement.addEventListener("click",this),this.confirmBtnElement.addEventListener("click",this)};ListDialogView.prototype=new View,ListDialogView.prototype.beforeShow=function(){this.textElement.value=this.app.data.list.map(function(a){return a[1]+"	"+a[0]}).join("\n")},ListDialogView.prototype.afterShow=function(){this.textElement.focus()},ListDialogView.prototype.handleEvent=function(a){switch(a.target){case this.confirmBtnElement:this.submit();break;case this.cancelBtnElement:this.close()}},ListDialogView.prototype.submit=function(){var a,b=this.textElement;a=window.btoa?"#base64-list:"+window.btoa(unescape(encodeURIComponent(b.value))):"#list:"+encodeURIComponent(b.value);var c=this.app.pushUrlHash(a);c||this.app.pushUrlHash("#list")},ListDialogView.prototype.close=function(){this.app.switchUIState(this.app.UI_STATE_DASHBOARD)};var AboutDialogView=function(a){this.load(a,{name:"about-dialog",element:"wc-about-dialog",donateElement:"wc-about-donate",donateContentElement:"wc-about-donate-content",contentElement:"wc-about-content",closeBtnElement:"wc-about-close-btn"}),this.loaded=!1,this.closeBtnElement.addEventListener("click",this),this.contentElement.addEventListener("click",this),this.donateContentElement.addEventListener("submit",this),document.addEventListener("localized",this)};AboutDialogView.prototype=new View,AboutDialogView.prototype.beforeShow=function(){this.app.logAction("AboutDialogView::view"),this.loaded=!0;var a=document.documentElement.lang;this.loadContent(a,!0)},AboutDialogView.prototype.loadContent=function(a,b){var c=document.createElement("iframe");c.src="about."+a+".html",this.contentElement.appendChild(c),c.onload=function(){for(var a=document.importNode(c.contentWindow.document.body,!0),b=document.createDocumentFragment();a.firstElementChild;)b.appendChild(a.firstElementChild);for(var d=this.contentElement;d.firstChild;)d.removeChild(d.firstChild);d.appendChild(b)}.bind(this),b&&(c.onerror=function(){this.loaded=!1,this.element.hasAttribute("hidden")||this.app.switchUIState(this.app.UI_STATE_SOURCE_DIALOG)}.bind(this)),window.DONATE_HTML&&(this.donateElement.removeAttribute("hidden"),this.donateContentElement.innerHTML=window.DONATE_HTML.replace(/%lang/,a.replace(/-/,"_")))},AboutDialogView.prototype.handleEvent=function(a){if("localized"===a.type)return void(this.loaded=!1);switch(a.currentTarget){case this.contentElement:if("A"!==a.target.tagName)break;a.preventDefault(),window.open(a.target.href),this.app.logAction("AboutDialogView::externalLink",a.target.href);break;case this.donateContentElement:this.app.logAction("AboutDialogView::donateLink");break;case this.closeBtnElement:this.close()}},AboutDialogView.prototype.close=function(){this.app.switchUIState(this.app.UI_STATE_SOURCE_DIALOG)};var SNSPushView=function(a){this.load(a,{name:"sns-push",element:"wc-sns-push",facebookElement:"wc-sns-facebook",googlePlusElement:"wc-sns-google-plus"}),"complete"===document.webL10n.getReadyState()&&this.loadButtons(),window.addEventListener("localized",this)};SNSPushView.prototype=new View,SNSPushView.prototype.FACEBOOK_BUTTON_URL="https://www.facebook.com/plugins/like.php?href=%url&layout=box_count&show_faces=false&width=55&action=like&font=trebuchet+ms&colorscheme=light&height=65&locale=%lang",SNSPushView.prototype.GOOGLEPLUS_BUTTON_URL="https://plusone.google.com/u/0/_/+1/fastbutton?url=%url&size=tall&count=true&annotation=bubble&lang=%lang",SNSPushView.prototype.loadButtons=function(){var a=window.location.href;-1!==a.indexOf("#")&&(a=a.replace(/#.*$/,"").replace(/\?.*$/,""));var b=document.documentElement.lang;this.updateFrame(this.facebookElement,this.FACEBOOK_BUTTON_URL.replace(/%url/,encodeURIComponent(a)).replace(/%lang/,b.replace(/-/,"_"))),this.updateFrame(this.googlePlusElement,this.GOOGLEPLUS_BUTTON_URL.replace(/%url/,encodeURIComponent(a)).replace(/%lang/,b))},SNSPushView.prototype.updateFrame=function(a,b){for(;a.firstElementChild;)a.removeChild(a.firstElementChild);var c=document.createElement("iframe");c.src=b,c.setAttribute("scrolling","no"),c.setAttribute("frameborder","0"),c.setAttribute("allowTransparency","true"),a.appendChild(c)},SNSPushView.prototype.handleEvent=function(a){switch(a.type){case"localized":this.loadButtons()}};var PSMView=function(a){this.load(a,{name:"psm",element:"wc-psm"}),"complete"===document.webL10n.getReadyState()&&this.loadFrame(),window.addEventListener("localized",this)};PSMView.prototype=new View,PSMView.prototype.URL="http://timdream.org/psm/#locale=%lang",PSMView.prototype.loadFrame=function(){for(var a=document.documentElement.lang,b=this.element;b.firstElementChild;)b.removeChild(b.firstElementChild);var c=document.createElement("iframe");c.src=this.URL.replace(/%lang/,a),c.setAttribute("scrolling","no"),c.setAttribute("frameborder","0"),c.setAttribute("allowTransparency","true"),b.appendChild(c)},PSMView.prototype.handleEvent=function(a){switch(a.type){case"localized":this.loadFrame()}};var CanvasView=function(a){this.load(a,{name:"canvas",element:"wc-canvas",canvasElement:"wc-canvas-canvas",hoverElement:"wc-canvas-hover",hoverLabelElement:"wc-canvas-hover-label"}),window.addEventListener("resize",this),this.canvasElement.addEventListener("wordcloudstop",this),this.documentWidth=window.innerWidth,this.documentHeight=window.innerHeight;var b=this.canvasElement.style;["transform","webkitTransform","msTransform","oTransform"].some(function(a){return a in b?(this.cssTransformProperty=a,!0):!1}.bind(this)),this.idleOption={fontFamily:"Times, serif",color:"rgba(255, 255, 255, 0.8)",rotateRatio:.5,backgroundColor:"transparent",wait:75,list:function(){var a=[],b=[5,4,3,2,2],c="Arai,Awan,Bodjal,Boira,Bulud,Bulut,Caad,Chmura,Clood,Cloud,Cwmwl,Dampog,Debesis,Ewr,Felhő,Hodei,Hûn,Koumoul,Leru,Lipata,Mixtli,Moln,Mây,Méga,Mākoņi,Neul,Niula,Nivulu,Nor,Nouage,Nuage,Nube,Nubes,Nubia,Nubo,Nuvem,Nuvi,Nuvia,Nuvola,Nwaj,Nívol,Nóvvla,Nùvoła,Nùvula,Núvol,Nûl,Nûlêye,Oblaci,Oblak,Phuyu,Pil'v,Pilv,Pilvi,Qinaya,Rahona,Rakun,Retë,Scamall,Sky,Ský,Swarken,Ulap,Vo'e,Wingu,Wolcen,Wolk,Wolke,Wollek,Wulke,dilnu,Νέφος,Абр,Болот,Болытлар,Булут,Бұлттар,Воблакі,Облак,Облака,Хмара,Үүл,Ամպ,וואלקן,ענן,ابر,بادل,بدل,سحاب,ورېځ,ھەور,ܥܢܢܐ,ढग,बादल,सुपाँय्,মেঘ,ਬੱਦਲ,વાદળ,முகில்,మేఘం,മേഘം,เมฆ,སྤྲིན།,ღრუბელი,ᎤᎶᎩᎸ,ᓄᕗᔭᖅ,云,雲,구름".split(",");return b.forEach(function(b){c.forEach(function(c){a.push([c,b])})}),a}()}};CanvasView.prototype=new View,CanvasView.prototype.TILT_DEPTH=10,CanvasView.prototype.beforeShow=CanvasView.prototype.beforeHide=function(a,b){switch(b){case this.app.UI_STATE_SOURCE_DIALOG:if(a==this.app.UI_STATE_ABOUT_DIALOG)break;this.drawIdleCloud();break;case this.app.UI_STATE_LOADING:case this.app.UI_STATE_WORKING:this.empty()}},CanvasView.prototype.handleEvent=function(a){switch(a.type){case"resize":this.documentWidth=window.innerWidth,this.documentHeight=window.innerHeight;break;case"wordclouddrawn":if(a.detail.drawn)break;a.preventDefault();break;case"wordcloudstop":this.canvasElement.removeEventListener("wordclouddrawn",this);break;case"mousemove":var b=this.documentWidth/2,c=this.documentHeight/2,d=-(b-a.pageX)/b*this.TILT_DEPTH,e=(c-a.pageY)/c*this.TILT_DEPTH;this.canvasElement.style[this.cssTransformProperty]="scale(1.2) translateZ(0) rotateX("+e+"deg) rotateY("+d+"deg)"}},CanvasView.prototype.setDimension=function(a,b){var c=this.canvasElement;a=a?a:this.documentWidth,b=b?b:this.documentHeight,c.setAttribute("width",a),c.setAttribute("height",b),this.element.style.marginLeft=-a/2+"px",this.element.style.marginTop=-b/2+"px"},CanvasView.prototype.draw=function(a){this.canvasElement.lang="",this.hoverElement.setAttribute("hidden",!0),a.hover=this.handleHover.bind(this),WordCloud(this.canvasElement,a)},CanvasView.prototype.handleHover=function(a,b){var c=this.hoverElement;return a?(c.removeAttribute("hidden"),c.style.left=b.x+"px",c.style.top=b.y+"px",c.style.width=b.w+"px",c.style.height=b.h+"px",this.hoverDimension=b,this.hoverLabelElement.setAttribute("data-l10n-args",JSON.stringify({word:a[0],count:a[1]})),void __(this.hoverLabelElement)):void c.setAttribute("hidden",!0)},CanvasView.prototype.drawIdleCloud=function(){var a=this.canvasElement,b=this.documentWidth,c=this.documentHeight;"ontouchstart"in window||document.addEventListener("mousemove",this),this.canvasElement.style[this.cssTransformProperty]="scale(1.2)",this.setDimension(b,c),this.idleOption.gridSize=Math.round(16*b/1024),this.idleOption.weightFactor=function(a){return Math.pow(a,2.3)*b/1024},a.lang="en",a.addEventListener("wordclouddrawn",this),WordCloud(a,this.idleOption),this.hoverElement.setAttribute("hidden",!0)},CanvasView.prototype.empty=function(){document.removeEventListener("mousemove",this),this.canvasElement.style[this.cssTransformProperty]="",WordCloud(this.canvasElement,{backgroundColor:"transparent"})};var SourceDialogView=function(a){this.load(a,{name:"source-dialog",element:"wc-source-dialog",menuElement:"wc-source-menu",selectionElement:"wc-source-selection",startBtnElement:"wc-source-start-btn",loginFacebookBtnElement:"wc-source-login-facebook-btn",panelContainerElement:"wc-source-panels",aboutBtnElement:"wc-source-about-btn"}),this.currentPanel=null,this.panels={};var b=this.selectionElement,c=this.menuElement.getElementsByTagName("a");Array.prototype.forEach.call(c,function(a){var c=document.createElement("option");c.value=a.getAttribute("data-panel"),c.setAttribute("data-l10n-id",a.getAttribute("data-l10n-id")),c.appendChild(document.createTextNode(a.textContent)),b.appendChild(c)}),this.menuElement.addEventListener("click",this),this.selectionElement.addEventListener("change",this),this.startBtnElement.addEventListener("click",this),this.loginFacebookBtnElement.addEventListener("click",this),this.panelContainerElement.addEventListener("submit",this),this.aboutBtnElement.addEventListener("click",this)};SourceDialogView.prototype=new View,SourceDialogView.prototype.afterShow=function(){this.currentPanel&&this.currentPanel.show()},SourceDialogView.prototype.handleEvent=function(a){var b;if(a.preventDefault(),"submit"==a.type)return void this.currentPanel.submit();switch(a.currentTarget){case this.menuElement:if(b=a.target.getAttribute("data-panel"),!b||!this.panels[b])return;this.showPanel(this.panels[b]);break;case this.selectionElement:if(b=a.target.value,!b||!this.panels[b])return;this.showPanel(this.panels[b]);break;case this.aboutBtnElement:this.app.switchUIState(this.app.UI_STATE_ABOUT_DIALOG);break;case this.startBtnElement:case this.loginFacebookBtnElement:this.currentPanel.submit()}},SourceDialogView.prototype.submit=function(a){return this.app.pushUrlHash(a)},SourceDialogView.prototype.showPanel=function(a){this.currentPanel&&this.currentPanel.hide(),"facebook"!==a.name||a.hasPermission?(this.startBtnElement.hidden=!1,this.loginFacebookBtnElement.hidden=!0):(this.startBtnElement.hidden=!0,this.loginFacebookBtnElement.hidden=!1),a.show(),this.currentPanel=a,this.app&&this.app.logAction("SourceDialogView::showPanel",a.name)},SourceDialogView.prototype.addPanel=function(a){if(this.panels[a.name]=a,a.menuItemElement=this.menuElement.querySelector('[data-panel="'+a.name+'"]'),a.selectionIndex=Array.prototype.indexOf.call(this.menuElement.children,a.menuItemElement.parentNode),!a.menuItemElement)throw"menuItemElement not found.";return a.menuItemElement.parentNode.removeAttribute("hidden"),a.dialog=this,"isSupported"in a&&!a.isSupported?(a.menuItemElement.parentNode.className+=" disabled",void a.menuItemElement.removeAttribute("data-panel")):void(this.currentPanel||this.showPanel(a))};var DashboardView=function(a){this.load(a,{name:"dashboard",element:"wc-dashboard"});for(var b=this.element.querySelectorAll("[data-action]"),c=b.length;c--;)b[c].addEventListener("click",this)};DashboardView.prototype=new View,DashboardView.prototype.beforeShow=DashboardView.prototype.beforeHide=function(a,b){var c,d=this.element.querySelectorAll("[data-canvas-ctl]"),e=d.length;if(b===this.app.UI_STATE_DASHBOARD)for(;e--;)c=d[e],c.className=c.className.replace(/ disabled/g,"");else for(;e--;)c=d[e],c.className+=" disabled"},DashboardView.prototype.handleEvent=function(a){var b=a.currentTarget;if(-1===b.className.indexOf("disabled")){var c=this.app,d=b.getAttribute("data-action");switch(this.app.logAction("DashboardView::action",d),d){case"back":c.reset();break;case"refresh":c.draw();break;case"theme":c.data.theme++,c.data.theme>=c.themes.length&&(c.data.theme=0),c.draw();break;case"shape":c.data.shape++,c.data.shape>=c.shapes.length&&(c.data.shape=0),c.draw();break;case"edit":c.switchUIState(c.UI_STATE_LIST_DIALOG);break;case"size+":c.data.weightFactor+=.1,c.draw();break;case"size-":if(c.data.weightFactor<=.1)break;c.data.weightFactor-=.1,c.draw();break;case"gap+":c.data.gridSize++,c.draw();break;case"gap-":if(c.data.gridSize<=2)break;c.data.gridSize--,c.draw();break;case"save":var e=c.getCanvasElement().toDataURL();if("download"in document.createElement("a"))b.href=e,setTimeout(function(){b.href="#"},0);else{a.preventDefault();var f=window.open("blank.html","_blank","width=500,height=300,resizable=yes,menubar=yes"),g=function h(){f.removeEventListener("load",h),f.detachEvent&&f.detachEvent("onload",h);for(var a=f.document;a.body.firstElementChild;)a.body.removeChild(a.body.firstElementChild);var b=a.createElement("img");b.id="popup-image",b.src=e,a.getElementsByTagName("title")[0].textContent=_("image-popup-title"),a.body.appendChild(b)};f.attachEvent?"complete"===f.document.readyState?g():f.attachEvent("onload",g):f.addEventListener("load",g)}break;case"share":c.showSharer()}}};var SharerDialogView=function(a){if(this.load(a,{name:"sharer-dialog",element:"wc-sharer-dialog",titleElement:"wc-sharer-title",imgElement:"wc-sharer-img",imgLinkElement:"wc-sharer-img-link",progressElement:"wc-sharer-progress",titleInputElement:"wc-sharer-title-input",descInputElement:"wc-sharer-desc",termsElement:"wc-sharer-terms",hashTagElement:"wc-sharer-hashtag",imgurStatusElement:"wc-sharer-imgur-status",facebookStatusElement:"wc-sharer-facebook-status",tumblrStatusElement:"wc-sharer-tumblr-status",twitterStatusElement:"wc-sharer-twitter-status",plurkStatusElement:"wc-sharer-plurk-status",reUploadBtnElement:"wc-sharer-reupload-btn",doneBtnElement:"wc-sharer-done-btn"}),this.hashTagElement.textContent=this.HASHTAG,this.imgLinkElement.addEventListener("click",this),this.imgurStatusElement.addEventListener("click",this),this.facebookStatusElement.addEventListener("click",this),this.tumblrStatusElement.addEventListener("click",this),this.twitterStatusElement.addEventListener("click",this),this.plurkStatusElement.addEventListener("click",this),this.doneBtnElement.addEventListener("click",this),this.reUploadBtnElement.addEventListener("click",this),window.URL&&this.imgElement.addEventListener("load",function(){window.URL.revokeObjectURL(this.src)}),!window.HTMLCanvasElement.prototype.toBlob){var b=document.createElement("script");b.src="./assets/canvas-to-blob/canvas-to-blob.min.js?_=i2hqie3e",document.documentElement.firstElementChild.appendChild(b)}this.stringIds=["image-upload-not-supported","share-text-only","image-uploading","waiting","image-uploaded","click-to-share","image-upload-failed","facebook-loading","load-facebook-sdk","facebook-sdk-loading"]};SharerDialogView.prototype=new View,SharerDialogView.prototype.HASHTAG="#HTML5WordCloud",SharerDialogView.prototype.TWITTER_SHARE_URL="https://twitter.com/home/?status=",SharerDialogView.prototype.PLURK_SHARE_URL="http://plurk.com/?status=",SharerDialogView.prototype.FACEBOOK_PHOTO_URL="https://www.facebook.com/photo.php?fbid=",SharerDialogView.prototype.FACEBOOK_POST_URL="https://www.facebook.com/permalink.php?id=%uid&v=wall&story_fbid=%fbid",SharerDialogView.prototype.IMGUR_URL="http://imgur.com/",SharerDialogView.prototype.IMGUR_API_URL="https://api.imgur.com/3/upload.json",SharerDialogView.prototype.SHARED_ITEM_LIMIT=10,SharerDialogView.prototype.LABEL_IMAGE_UPLOAD_NOT_SUPPORTED=0,SharerDialogView.prototype.LABEL_SHARE_TEXT_ONLY=1,SharerDialogView.prototype.LABEL_IMAGE_UPLOADING=2,SharerDialogView.prototype.LABEL_WAITING=3,SharerDialogView.prototype.LABEL_IMAGE_UPLOADED=4,SharerDialogView.prototype.LABEL_CLICK_TO_SHARE=5,SharerDialogView.prototype.LABEL_IMAGE_UPLOAD_FAILED=6,SharerDialogView.prototype.LABEL_FACEBOOK_LOADING=7,SharerDialogView.prototype.LABEL_LOAD_FBSDK=8,SharerDialogView.prototype.LABEL_FBSDK_LOADING=9,SharerDialogView.prototype.beforeShow=function(){window.FB&&!this.facebookSDKReadyState&&(this.facebookSDKReadyState="complete",FB.getLoginStatus(this.updateFacebookStatus.bind(this)),FB.Event.subscribe("auth.authResponseChange",this.updateFacebookStatus.bind(this))),this.uploadSupported=!!(window.HTMLCanvasElement.prototype.toBlob&&window.XMLHttpRequest&&window.FormData),this.uploadSupported&&!this.imgurData?this.uploadImage():this.updateUI()},SharerDialogView.prototype.updateTermsUI=function(){this.termsElement.textContent=this.getCloudList()},SharerDialogView.prototype.getCloudTitle=function(){return this.app.data.title||_("my-word-cloud")},SharerDialogView.prototype.getCloudList=function(){var a=this.app.data.list,b=0,c=[];do c[b]=a[b][0];while(++b<this.SHARED_ITEM_LIMIT);return c.join(_("sep").replace(/"/g,""))+(a.length>this.SHARED_ITEM_LIMIT?_("frequent-terms-more"):"")},SharerDialogView.prototype.updateFacebookStatusElement=function(a,b){var c=this.facebookStatusElement;switch(this.facebookSDKReadyState){case"complete":this.updateStatusElement(c,a,b);break;case"loading":this.updateStatusElement(c,this.LABEL_FBSDK_LOADING);break;default:this.updateStatusElement(c,this.LABEL_LOAD_FBSDK,"#")}},SharerDialogView.prototype.updateStatusElement=function(a,b,c){c?(a.className="",a.href=c):(a.className="disabled",a.href=""),a.setAttribute("data-l10n-id",this.stringIds[b]),__(a)},SharerDialogView.prototype.updateUI=function(){if(this.xhr)this.reUploadBtnElement.disabled=!0,this.updateStatusElement(this.imgurStatusElement,this.LABEL_IMAGE_UPLOADING),this.updateFacebookStatusElement(this.LABEL_WAITING),this.updateStatusElement(this.tumblrStatusElement,this.LABEL_WAITING),this.updateStatusElement(this.twitterStatusElement,this.LABEL_WAITING),this.updateStatusElement(this.plurkStatusElement,this.LABEL_WAITING);else if(this.imgurData){var a=this.IMGUR_URL+this.imgurData.id;this.reUploadBtnElement.disabled=!1,this.updateStatusElement(this.imgurStatusElement,this.LABEL_IMAGE_UPLOADED,a),this.facebookPostedUrl?this.updateStatusElement(this.facebookStatusElement,this.LABEL_IMAGE_UPLOADED,this.facebookPostedUrl):this.facebookLoading?this.updateStatusElement(this.facebookStatusElement,this.LABEL_FACEBOOK_LOADING):this.updateFacebookStatusElement(this.LABEL_CLICK_TO_SHARE,"#"),this.updateStatusElement(this.tumblrStatusElement,this.LABEL_CLICK_TO_SHARE,"#"),this.updateStatusElement(this.twitterStatusElement,this.LABEL_CLICK_TO_SHARE,"#"),this.updateStatusElement(this.plurkStatusElement,this.LABEL_CLICK_TO_SHARE,"#")}else this.uploadSupported||this.updateTermsUI(),this.reUploadBtnElement.disabled=!0,this.uploadSupported?this.updateStatusElement(this.imgurStatusElement,this.LABEL_IMAGE_UPLOAD_FAILED):this.updateStatusElement(this.imgurStatusElement,this.LABEL_IMAGE_UPLOAD_NOT_SUPPORTED),this.updateFacebookStatusElement(this.LABEL_SHARE_TEXT_ONLY,"#"),this.updateStatusElement(this.tumblrStatusElement,this.LABEL_SHARE_TEXT_ONLY,"#"),this.updateStatusElement(this.twitterStatusElement,this.LABEL_SHARE_TEXT_ONLY,"#"),this.updateStatusElement(this.plurkStatusElement,this.LABEL_SHARE_TEXT_ONLY,"#")},SharerDialogView.prototype.afterHide=function(){this.xhr&&(this.xhr.abort(),this.xhr=null)},SharerDialogView.prototype.handleEvent=function(a){if(a.target.disabled||"disabled"===a.target.className)return void a.preventDefault();switch(a.currentTarget){case this.imgLinkElement:if(this.imgurData)break;a.preventDefault();break;case this.facebookStatusElement:if(this.facebookPostedUrl)break;if(!this.facebookSDKReadyState)return this.facebookSDKReadyState="loading",this.updateUI(),(new FacebookSDKLoader).load(function(){"complete"!==this.facebookSDKReadyState&&(this.facebookSDKReadyState="complete",FB.getLoginStatus(this.updateFacebookStatus.bind(this)),FB.Event.subscribe("auth.authResponseChange",this.updateFacebookStatus.bind(this)))}.bind(this)),void a.preventDefault();this.share("facebook"),a.preventDefault();break;case this.tumblrStatusElement:this.share("tumblr"),a.preventDefault();break;case this.twitterStatusElement:this.share("twitter"),a.preventDefault();break;case this.plurkStatusElement:this.share("plurk"),a.preventDefault();break;case this.reUploadBtnElement:this.uploadImage();break;case this.doneBtnElement:this.close()}},SharerDialogView.prototype.close=function(){this.app.switchUIState(this.app.UI_STATE_DASHBOARD)},SharerDialogView.prototype.getCanvasBlob=function(a){this.app.getCanvasElement().toBlob(a.bind(this))},SharerDialogView.prototype.updateProgress=function(a,b){this.progressElement.style.width=Math.floor(100*a)+"%",this.progressElement.parentNode.className="progress progress-striped"+(b?" active":"")},SharerDialogView.prototype.share=function(a){return"facebook"!==a||window.UPLOAD_PHOTO_TO_FACEBOOK?void(this.imgurData?this.shareImage(a):this.shareText(a)):void this.shareText(a)},SharerDialogView.prototype.shareText=function(a){this.app.logAction("SharerDialogView::shareText",a);var b=this.titleInputElement.value||this.getCloudTitle(),c=this.descInputElement.value||this.getCloudList()+"\n\n"+this.HASHTAG,d=window.location.href,e=d.length>128?d.replace(/#.*$/,""):d;switch(a){case"facebook":var f=document.querySelector('meta[property="og:image"]').content;this.facebookLoading=!0,this.updateUI();var g;g=this.imgurData?{method:"feed",link:this.IMGUR_URL+this.imgurData.id,display:"popup"}:{method:"feed",picture:f,link:d,name:this.getCloudTitle(),description:this.getCloudList()+" -- "+this.HASHTAG,display:"popup"},FB.ui(g,function(a){if(this.facebookLoading=!1,!a||!a.post_id)return void this.updateUI();var b=a.post_id.split("_");this.facebookPostedUrl=this.FACEBOOK_POST_URL.replace(/%uid/,b[0]).replace(/%fbid/,b[1]),this.updateUI()}.bind(this));break;case"plurk":window.open(this.PLURK_SHARE_URL+encodeURIComponent(e+" ("+b+") "+c));break;case"twitter":window.open(this.TWITTER_SHARE_URL+encodeURIComponent(e+" "+b+" "+c),null,"width=575,height=216");break;case"tumblr":window.open("http://www.tumblr.com/share/link?=description="+encodeURIComponent(c)+"&name="+encodeURIComponent(b)+"&url="+encodeURIComponent(d)),this.close();break;default:throw"Unknown shareDialogView type "+a}},SharerDialogView.prototype.updateFacebookStatus=function(a){"connected"===a.status?FB.api("/me/permissions",function(a){this.hasFacebookPermission=a&&a.data&&a.data[0]&&1==a.data[0].publish_stream,this.updateUI()}.bind(this)):this.hasFacebookPermission=!1,this.updateUI()},SharerDialogView.prototype.uploadImage=function(){if(!window.IMGUR_CLIENT_ID)throw"IMGUR_CLIENT_ID is not set.";this.app.logAction("SharerDialogView::uploadImage"),this.imgurData=void 0,this.facebookPostedUrl=void 0,this.imgLinkElement.href="#",this.updateProgress(.05,!0);var a=this.titleInputElement.value||this.getCloudTitle(),b=this.descInputElement.value||this.getCloudList()+"\n\n"+this.HASHTAG,c=window.location.href;c.length>128&&(c=c.replace(/#.*$/,"")),this.cloudUrl=c;var d=new FormData;d.append("title",a),d.append("name","wordcloud.png"),d.append("description",b+"\n\n"+c);var e=this.xhr=new XMLHttpRequest;e.open("POST",this.IMGUR_API_URL),e.setRequestHeader("Authorization","Client-ID "+IMGUR_CLIENT_ID),e.upload?e.upload.onprogress=function(a){this.updateProgress(a.loaded/a.total,!0)}.bind(this):this.updateProgress(1,!0),e.onreadystatechange=function(){if(e.readyState===XMLHttpRequest.DONE&&this.xhr===e){this.checkImgurCredits(),this.xhr=null;var a;try{a=JSON.parse(e.responseText)}catch(b){}var c=a?a.success:!1;if(!c)return a&&429===a.status&&alert(_("imgur-limit-msg")),this.app.logAction("SharerDialogView::uploadImage::failed",a?a.status:"N/A"),this.updateProgress(.05,!1),void this.updateUI();this.imgurData=a.data,this.imgLinkElement.href=this.IMGUR_URL+this.imgurData.id,this.app.logAction("SharerDialogView::uploadImage::success"),this.updateProgress(1,!1),this.updateUI()}}.bind(this),this.updateUI(),this.updateTermsUI(),this.getCanvasBlob(function(a){this.xhr===e&&(this.imgElement.src=window.URL?window.URL.createObjectURL(a):this.app.getCanvasElement().toDataURL(),this.imgLinkElement.removeAttribute("hidden"),d.append("image",a),e.send(d))})},SharerDialogView.prototype.shareImage=function(a){this.app.logAction("SharerDialogView::shareImage2",a);var b=this.titleInputElement.value||this.getCloudTitle(),c=this.descInputElement.value||this.getCloudList()+"\n\n"+this.HASHTAG,d=this.cloudUrl;switch(a){case"facebook":if(!this.hasFacebookPermission)return void FB.login(function(b){return this.element.hasAttribute("hidden")?void this.app.logAction("SharerDialogView::facebook-login::cancelled"):(this.app.logAction("SharerDialogView::facebook-login::success"),void("connected"===b.status&&(this.hasFacebookPermission=!0,this.shareImage(a))))}.bind(this),{scope:"publish_stream"});this.facebookLoading=!0,this.updateUI(),FB.api("/me/photos","post",{url:this.imgurData.link,message:this.titleInputElement.value+"\n\n"+this.descInputElement.value+"\n\n"+d},function(b){return this.facebookLoading=!1,b&&b.id?(this.facebookPostedUrl=this.FACEBOOK_PHOTO_URL+b.id,void this.updateUI()):(this.shareText(a),void this.updateUI())}.bind(this));break;case"plurk":window.open(this.PLURK_SHARE_URL+encodeURIComponent(this.imgurData.link+" "+d+" ("+b+") "+c));break;case"twitter":window.open(this.TWITTER_SHARE_URL+encodeURIComponent(d+" "+b+" "+c+" "+this.imgurData.link));break;case"tumblr":window.open("http://www.tumblr.com/share/photo?source="+encodeURIComponent(this.imgurData.link)+"&desc="+encodeURIComponent(b+"\n"+c+"\n\n"+d)+"&clickthru="+encodeURIComponent(d));break;default:throw"Unknown shareDialogView type "+a}},SharerDialogView.prototype.checkImgurCredits=function(){var a=new XMLHttpRequest;a.open("GET","https://api.imgur.com/3/credits"),a.setRequestHeader("Authorization","Client-ID "+IMGUR_CLIENT_ID),a.onreadystatechange=function(){if(a.readyState===XMLHttpRequest.DONE){var b;try{b=JSON.parse(a.responseText)}catch(c){}b&&b.success&&(this.imgurCreditsData=b.data,this.app.logAction("SharerDialogView::checkImgurCredits::ClientRemaining",b.data.ClientRemaining))}}.bind(this),a.send()};var PanelView=function(){};PanelView.prototype=new View,PanelView.prototype.beforeShow=function(){this.menuItemElement.parentNode.className+=" active",this.dialog.selectionElement.selectedIndex=this.selectionIndex},PanelView.prototype.afterShow=function(){var a=this.element.querySelector("input, button, select, textarea");a&&a.focus()},PanelView.prototype.beforeHide=function(){this.menuItemElement.parentNode.className=this.menuItemElement.parentNode.className.replace(/ active/g,"")};var ExamplePanelView=function(a){this.load(a,{name:"example",element:"wc-panel-example",supportMsgElement:"wc-panel-example-support-msg"}),this.checked=!1};ExamplePanelView.prototype=new PanelView,ExamplePanelView.prototype.beforeShow=function(){PanelView.prototype.beforeShow.apply(this,arguments),this.checked||(this.dialog.app.isFullySupported||this.supportMsgElement.removeAttribute("hidden"),this.checked=!0)},ExamplePanelView.prototype.submit=function(){var a=this.element.querySelectorAll('[name="example"]');for(var b in a)if(a[b].checked){this.dialog.submit("#"+a[b].value);break}};var CPPanelView=function(a){this.load(a,{name:"cp",element:"wc-panel-cp",textareaElement:"wc-panel-cp-textarea"})};CPPanelView.prototype=new PanelView,CPPanelView.prototype.submit=function(){var a=this.textareaElement;if(a.value.length){var b;b=this.dialog.submit(window.btoa?"#base64:"+window.btoa(unescape(encodeURIComponent(a.value))):"#text:"+encodeURIComponent(a.value)),b||this.dialog.submit("#text")
}};var FilePanelView=function(a){if(this.load(a,{name:"file",element:"wc-panel-file",fileElement:"wc-panel-file-file",fileLabelElement:"wc-panel-file-file-label",encodingElement:"wc-panel-file-encoding"}),this.isSupported){var b=this.fileElement.files.length;this.updateLabel(b),this.fileElement.addEventListener("change",this)}};FilePanelView.prototype=new PanelView,FilePanelView.prototype.handleEvent=function(){var a=this.fileElement.files.length;this.updateLabel(a)},FilePanelView.prototype.updateLabel=function(a){this.fileLabelElement.setAttribute("data-l10n-args",'{ "n": '+a+"}"),__(this.fileLabelElement)},FilePanelView.prototype.isSupported=!!window.FileReader,FilePanelView.prototype.submit=function(){var a=this.fileElement;if(a.files.length){var b=a.files[0];return"text/plain"!==b.type?void alert(_("plain-text-file-please")):void this.dialog.submit("#file")}};var FeedPanelView=function(a){this.load(a,{name:"feed",element:"wc-panel-feed",inputElement:"wc-panel-feed-url",template:"%s"})};FeedPanelView.prototype=new PanelView,FeedPanelView.prototype.submit=function(){var a=this.inputElement;a.value&&this.dialog.submit("#feed:"+this.template.replace(/%s/g,a.value))};var WikipediaPanelView=function(a){this.load(a,{name:"wikipedia",element:"wc-panel-wikipedia",inputElement:"wc-panel-wikipedia-title"})};WikipediaPanelView.prototype=new PanelView,WikipediaPanelView.prototype.submit=function(){var a=this.inputElement;if(a.value){var b=document.webL10n.getLanguage().substr(0,2);this.dialog.submit("#wikipedia."+b+":"+a.value)}};var FacebookPanelView=function(a){this.load(a,{name:"facebook",element:"wc-panel-facebook",statusElement:"wc-panel-facebook-status"}),this.stringIds=["facebook-ready","facebook-start-to-login"],this.loaded=!1};FacebookPanelView.prototype=new PanelView,FacebookPanelView.prototype.LABEL_LOGGED_IN=0,FacebookPanelView.prototype.LABEL_NOT_LOGGED_IN=1,FacebookPanelView.prototype.beforeShow=function(){PanelView.prototype.beforeShow.apply(this,arguments),this.loaded||(this.loaded=!0,this.hasPermission=!1,(new FacebookSDKLoader).load(function(){FB.getLoginStatus(this.updateStatus.bind(this)),FB.Event.subscribe("auth.authResponseChange",this.updateStatus.bind(this))}.bind(this)))},FacebookPanelView.prototype.isReadyForFetch=function(){return this.facebookResponse&&"connected"===this.facebookResponse.status&&this.hasPermission},FacebookPanelView.prototype.updateStatus=function(a){this.facebookResponse=a,"connected"===this.facebookResponse.status?FB.api("/me?fields=permissions,username",function(a){this.hasPermission=a&&a.permissions&&a.permissions.data&&a.permissions.data[0]&&1==a.permissions.data[0].read_stream,this.facebookUsername=a&&a.username||"",this.updateUI(),this.submitted&&(this.submitted=!1,this.submit())}.bind(this)):(this.hasPermission=!1,this.facebookUsername="",this.updateUI())},FacebookPanelView.prototype.updateUI=function(){this.isReadyForFetch()?this.statusElement.setAttribute("data-l10n-id",this.stringIds[this.LABEL_LOGGED_IN]):this.statusElement.setAttribute("data-l10n-id",this.stringIds[this.LABEL_NOT_LOGGED_IN]),__(this.statusElement)},FacebookPanelView.prototype.submit=function(){if(this.facebookResponse&&!this.element.hasAttribute("hidden")&&!this.dialog.element.hasAttribute("hidden")){if(!this.isReadyForFetch())return this.submitted=!0,void FB.login(function(a){return this.facebookResponse=a,a?"connected"!==a.status?void this.dialog.app.logAction("FacebookPanelView::login::cancelled"):void this.dialog.app.logAction("FacebookPanelView::login::success"):void this.dialog.app.logAction("FacebookPanelView::login::error")}.bind(this),{scope:"read_stream"});var a=this.facebookUsername||this.facebookResponse.authResponse.userID;this.dialog.submit("#facebook:"+a)}};var GooglePlusPanelView=function(a){this.load(a,{name:"googleplus",element:"wc-panel-googleplus",statusElement:"wc-panel-googleplus-status",idElement:"wc-panel-googleplus-id"}),this.stringIds=["google-ready","google-start-to-login"],this.loaded=!1};GooglePlusPanelView.prototype=new PanelView,GooglePlusPanelView.prototype.LABEL_LOGGED_IN=0,GooglePlusPanelView.prototype.LABEL_NOT_LOGGED_IN=1,GooglePlusPanelView.prototype.beforeShow=function(){if(PanelView.prototype.beforeShow.apply(this,arguments),!GOOGLE_CLIENT_ID)throw"No GOOGLE_CLIENT_ID defined.";if(!this.loaded){this.loaded=!0;var a=document.createElement("script");a.src="./assets/go2/src/google-oauth2.js?_=i2hqie3e",a.onload=a.onerror=function(){if(a.onload=a.onerror=null,!window.GO2)return void(this.loaded=!1);var b=window.GO2_REDIRECT_URI||document.location.href.replace(/\/(index.html)?(#.*)?$/i,"/go2-redirect.html"),c=this.go2=new GO2({clientId:GOOGLE_CLIENT_ID,scope:this.GOOGLE_API_SCOPE||"",redirectUri:b});c.login(!1,!0),this.updateUI(),c.onlogin=function(a){if(this.accessToken=a,this.updateUI(),this.submitted){if(this.submitted=!1,this.element.hasAttribute("hidden")||this.dialog.element.hasAttribute("hidden"))return;this.realSubmit()}}.bind(this),c.onlogout=function(){this.accessToken="",this.updateUI()}.bind(this)}.bind(this),document.documentElement.firstElementChild.appendChild(a)}},GooglePlusPanelView.prototype.isReadyForFetch=function(){return!!this.accessToken},GooglePlusPanelView.prototype.updateUI=function(){this.isReadyForFetch()?this.statusElement.setAttribute("data-l10n-id",this.stringIds[this.LABEL_LOGGED_IN]):this.statusElement.setAttribute("data-l10n-id",this.stringIds[this.LABEL_NOT_LOGGED_IN]),__(this.statusElement)},GooglePlusPanelView.prototype.submit=function(){return window.GO2&&this.loaded?this.isReadyForFetch()?void this.realSubmit():(this.submitted=!0,void this.go2.login(!0,!1)):void 0},GooglePlusPanelView.prototype.realSubmit=function(){var a=this.idElement.value;a||(a="me"),a=a.replace(/\/.*$/,""),this.dialog.submit("#googleplus:"+a)};var Fetcher=function(){};Fetcher.prototype.LABEL_VERB=LoadingView.prototype.LABEL_LOADING;var TextFetcher=function(){this.types=["text","base64"]};TextFetcher.prototype=new Fetcher,TextFetcher.prototype.stop=function(){clearTimeout(this.timer)},TextFetcher.prototype.getData=function(a,b){b="text"!==a||b?decodeURIComponent("base64"===a?escape(window.atob(b)):b):this.app.views["source-dialog"].panels.cp.textareaElement.value,this.timer=setTimeout(function(){this.app.handleData(b)}.bind(this),0)};var FileFetcher=function(){this.types=["file"]};FileFetcher.prototype=new Fetcher,FileFetcher.prototype.stop=function(){this.reader&&(this.reader.abort(),this.reader=null)},FileFetcher.prototype.getData=function(){var a=this.app.views["source-dialog"].panels.file,b=a.fileElement;if(!b.files.length)return this.app.reset(),void this.app.views["source-dialog"].showPanel(a);var c=b.files[0],d=this.reader=new FileReader;d.onloadend=function(){if(d===this.reader&&null!==d.result){var a=d.result;this.app.handleData(a)}}.bind(this),d.readAsText(c,a.encodingElement.value||"UTF-8")};var ListFetcher=function(){this.types=["list","base64-list"]};ListFetcher.prototype=new Fetcher,ListFetcher.prototype.stop=function(){clearTimeout(this.timer)},ListFetcher.prototype.getData=function(a,b){var c;c="list"!==a||b?decodeURIComponent("base64-list"===a?escape(window.atob(b)):b):this.app.views["list-dialog"].textElement.value;var d=0,e=[];c.split("\n").forEach(function(a){var b=a.split("	").reverse();a&&b[0]&&b[1]&&(b[1]=parseInt(b[1],10),isNaN(b[1])||(d+=b[0].length*b[1]*b[1],e.push(b)))}),this.timer=setTimeout(function(){this.app.handleList(e,d)}.bind(this),0)};var JSONPScriptDownloader=function(){};JSONPScriptDownloader.prototype.CALLBACK_PREFIX="JSONPCallbackX",JSONPScriptDownloader.prototype.reset=JSONPScriptDownloader.prototype.stop=function(){this.currentRequest=void 0,clearTimeout(this.timer)},JSONPScriptDownloader.prototype.handleEvent=function(a){var b=a.target;window[b.getAttribute("data-callback-name")]=void 0,this.currentRequest=void 0,clearTimeout(this.timer),b.parentNode.removeChild(b),"error"===a.type&&this.fetcher.handleResponse()},JSONPScriptDownloader.prototype.getNewCallbackName=function(){var a=this.CALLBACK_PREFIX+Math.random().toString(36).substr(2,8).toUpperCase();return window[a]=function(){this.currentRequest===a&&(this.currentRequest=void 0,clearTimeout(this.timer),this.fetcher.handleResponse.apply(this.fetcher,arguments))}.bind(this),a},JSONPScriptDownloader.prototype.requestData=function(a){var b=this.currentRequest=this.getNewCallbackName();a+=-1===a.indexOf("?")?"?":"&",a+="callback="+b;var c=this.scriptElement=document.createElement("script");c.src=a,c.setAttribute("data-callback-name",b),c.addEventListener("load",this),c.addEventListener("error",this),document.documentElement.firstElementChild.appendChild(c),clearTimeout(this.timer),this.timer=setTimeout(function(){window[b]()},this.fetcher.TIMEOUT)};var JSONPWorkerDownloader=function(){};JSONPWorkerDownloader.prototype.PATH="./assets/",JSONPWorkerDownloader.prototype.reset=JSONPWorkerDownloader.prototype.stop=function(){this.worker&&(clearTimeout(this.timer),this.worker.terminate(),this.worker=null)},JSONPWorkerDownloader.prototype.requestData=function(a){this.worker&&this.stop(),this.worker=new Worker(this.PATH+"downloader-worker.js"),this.worker.addEventListener("message",this),this.worker.addEventListener("error",this),this.worker.postMessage(a),clearTimeout(this.timer),this.timer=setTimeout(function(){this.stop(),this.fetcher.handleResponse()}.bind(this),this.fetcher.TIMEOUT)},JSONPWorkerDownloader.prototype.handleEvent=function(a){var b;switch(a.type){case"message":b=a.data;break;case"error":b=[],a.preventDefault()}this.stop(),this.fetcher.handleResponse.apply(this.fetcher,b)};var JSONPFetcher=function(){};JSONPFetcher.prototype=new Fetcher,JSONPFetcher.prototype.LABEL_VERB=LoadingView.prototype.LABEL_DOWNLOADING,JSONPFetcher.prototype.USE_WORKER_WHEN_AVAILABLE=!0,JSONPFetcher.prototype.TIMEOUT=3e4,JSONPFetcher.prototype.reset=function(){this.downloader&&this.downloader.reset()},JSONPFetcher.prototype.stop=function(){this.downloader&&this.downloader.stop(),this.downloader=null},JSONPFetcher.prototype.requestData=function(a){this.downloader=this.USE_WORKER_WHEN_AVAILABLE&&window.Worker?new JSONPWorkerDownloader:new JSONPScriptDownloader,this.downloader.fetcher=this,this.downloader.requestData(a)};var FeedFetcher=function(){this.types=["rss","feed"],this.params=[["v","1.0"],["scoring",this.FEED_API_SCORING],["num",this.FEED_API_NUM]]};FeedFetcher.prototype=new JSONPFetcher,FeedFetcher.prototype.FEED_API_LOAD_URL="https://ajax.googleapis.com/ajax/services/feed/load",FeedFetcher.prototype.FEED_API_CALLBACK_PREFIX="FeedFetcherCallback",FeedFetcher.prototype.FEED_API_NUM="-1",FeedFetcher.prototype.FEED_API_SCORING="h",FeedFetcher.prototype.ENTRY_REGEXP=/<[^>]+?>|\(.+?\.\.\.\)|\&\w+\;|<script.+?\/script\>/gi,FeedFetcher.prototype.getData=function(a,b){var c=[].concat(this.params);c.push(["q",b]),c.push(["context","ctx"]);var d=this.FEED_API_LOAD_URL+"?"+c.map(function(a){return a[0]+"="+encodeURIComponent(a[1])}).join("&");this.requestData(d)},FeedFetcher.prototype.handleResponse=function(a,b,c){if(!a||200!==c)return void this.app.handleData("");var d=[];b.feed.entries.forEach(function(a){d.push(a.title),d.push(a.content.replace(this.ENTRY_REGEXP,"")),d.push("")}.bind(this)),this.app.handleData(d.join("\n"),_("feed-title",{title:b.feed.title}))};var WikipediaFetcher=function(){this.types=["wiki","wikipedia"],this.params=[["action","query"],["prop","revisions"],["rvprop","content"],["redirects","1"],["format","json"],["rvparse","1"]]};WikipediaFetcher.prototype=new JSONPFetcher,WikipediaFetcher.prototype.WIKIPEDIA_API_URL="https://%lang.wikipedia.org/w/api.php",WikipediaFetcher.prototype.DEFAULT_LANG="en",WikipediaFetcher.prototype.PARSED_WIKITEXT_REGEXP=/<[^>]+?>|\(.+?\.\.\.\)|\&\w+\;|<script.+?\/script\>/gi,WikipediaFetcher.prototype.getData=function(a,b){var c=[].concat(this.params),d=a.split("."),e=d[1]?d[1]:this.DEFAULT_LANG;d[2]&&c.push(["converttitles",d[2]]),c.push(["titles",b]);var f=this.WIKIPEDIA_API_URL.replace(/%lang/,e)+"?"+c.map(function(a){return a[0]+"="+encodeURIComponent(a[1])}).join("&");this.requestData(f)},WikipediaFetcher.prototype.handleResponse=function(a){if(!a)return void this.app.handleData("");var b=Object.keys(a.query.pages)[0],c=a.query.pages[b];if(!("revisions"in c))return void this.app.handleData("");var d=c.revisions[0]["*"].replace(this.PARSED_WIKITEXT_REGEXP,"");this.app.handleData(d,_("wikipedia-title",{title:c.title}))};var GooglePlusFetcher=function(){this.types=["googleplus"],this.params=[["maxResults","100"],["alt","json"],["pp","1"]]};GooglePlusFetcher.prototype=new JSONPFetcher,GooglePlusFetcher.prototype.GOOGLE_PLUS_API_URL="https://www.googleapis.com/plus/v1/people/%source/activities/public",GooglePlusFetcher.prototype.POST_REGEXP=/<[^>]+?>|\(.+?\.\.\.\)|\&\w+\;|<script.+?\/script\>/gi,GooglePlusFetcher.prototype.getData=function(a,b){var c=this.app.views["source-dialog"].panels.googleplus,d=c.accessToken;if(!d)return this.app.logAction("GooglePlusFetcher::getData::reset"),this.app.reset(),void this.app.views["source-dialog"].showPanel(c);var e=[].concat(this.params);e.push(["access_token",d]);var f=this.GOOGLE_PLUS_API_URL.replace(/%source/,b)+"?"+e.map(function(a){return a[0]+"="+encodeURIComponent(a[1])}).join("&");this.requestData(f)},GooglePlusFetcher.prototype.handleResponse=function(a){if(!a||a.error||!a.items)return void this.app.handleData("");var b=a.items.map(function(a){return a.object.content.replace(this.POST_REGEXP,"")}.bind(this)).join("");this.app.handleData(b,_("google-plus-title"))};var COSCUPFetcher=function(){this.types=["coscup"],this.fields=["name","speaker","bio","abstract"]};COSCUPFetcher.prototype=new JSONPFetcher,COSCUPFetcher.prototype.API_URL="http://coscup.org/%year/api/program",COSCUPFetcher.prototype.HTML_REGEXP=/<[^>]+?>|\(.+?\.\.\.\)|\&\w+\;|<script.+?\/script\>/gi,COSCUPFetcher.prototype.getData=function(a,b){var c=this.year=b;this.requestData(this.API_URL.replace(/%year/,c))},COSCUPFetcher.prototype.handleResponse=function(a){if(!a)return void this.app.handleData("");var b=[],c=this.fields,d=this.HTML_REGEXP,e=Array.isArray(a)?a:a.program;e.forEach(function(a){c.forEach(function(c){a[c]&&b.push(a[c].replace(d,""))})}),this.app.handleData(b.join("\n"),_("coscup-title",{year:this.year}))};var FacebookFetcher=function(){this.types=["facebook"]};FacebookFetcher.prototype=new Fetcher,FacebookFetcher.prototype.LABEL_VERB=LoadingView.prototype.LABEL_DOWNLOADING,FacebookFetcher.prototype.FACEBOOK_GRAPH_FIELDS="name,notes.limit(500).fields(subject,message),feed.limit(2500).fields(from.fields(id),message)",FacebookFetcher.prototype.NOTE_REGEXP=/<[^>]+?>|\(.+?\.\.\.\)|\&\w+\;|<script.+?\/script\>/gi,FacebookFetcher.prototype.stop=function(){this.currentPath=void 0},FacebookFetcher.prototype.getData=function(a,b){var c=this.app.views["source-dialog"].panels.facebook;if(!c.isReadyForFetch())return this.app.logAction("FacebookFetcher::getData::reset"),this.app.reset(),void this.app.views["source-dialog"].showPanel(c);var d=this.currentPath="/"+encodeURIComponent(b)+"?fields="+this.FACEBOOK_GRAPH_FIELDS;FB.api(d,function(a){this.currentPath===d&&(this.currentPath=void 0,this.handleResponse(a))}.bind(this))},FacebookFetcher.prototype.handleResponse=function(a){if(!a||a.error)return void this.app.handleData("");var b=[];if(a.notes&&a.notes.data){var c=this.NOTE_REGEXP;a.notes.data.forEach(function(a){a.subject&&b.push(a.subject),a.message&&b.push(a.message.replace(c,""))})}a.feed&&a.feed.data&&a.feed.data.forEach(function(c){c.from.id===a.id&&c.message&&b.push(c.message)}),this.app.handleData(b.join("\n"),_("facebook-title",{name:a.name}))};var _gaq=_gaq||[];"timc.idv.tw"===window.location.hostname||"timdream.org"===window.location.hostname?(_gaq.push("timc.idv.tw"===window.location.hostname?["_setAccount","UA-401106-1"]:["_setAccount","UA-4623408-2"]),_gaq.push(["_trackPageview"]),function(){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}()):window.console&&(_gaq.push=function(){Function.prototype.apply.call(console.log,console,arguments),Array.prototype.push.apply(this,arguments)}),window.onerror=function(a,b,c){_gaq.push(["_trackEvent","JavaScript Exceptions",a,b+" ("+c+")"])},function(){if(document.querySelectorAll&&window.console){var a=document.querySelector('meta[property="og:image"]').content,b=document.querySelector('meta[property="og:url"]').content,c=document.querySelector('meta[property="fb:app_id"]').content,d=window.location.href.replace(/#.*$/,"").replace(/\?.*$/,"");(a.substr(0,d.length)!==d||b.substr(0,d.length)!==d||window.FACEBOOK_APP_ID&&c!==window.FACEBOOK_APP_ID)&&console.warn("Remember to change the content of <meta> tags in HTML.")}}(),function(){void 0===window.__&&(window.__=document.webL10n.translate),WordFreq.isSupported?WordFreqSync=null:WordFreq=null;var a=new WordCloudApp;if(a.isSupported){var b=new LanguageSwitcherView;b.app=a;var c=new SNSPushView;c.show();var d=new PSMView;d.show(),a.addView(new CanvasView),a.addView(new LoadingView),a.addView(new DashboardView),a.addView(new ListDialogView),a.addView(new SharerDialogView),a.addView(new AboutDialogView);var e=new SourceDialogView;a.addView(e),e.addPanel(new ExamplePanelView),e.addPanel(new CPPanelView),e.addPanel(new FilePanelView),e.addPanel(new WikipediaPanelView),e.addPanel(new FacebookPanelView),e.addPanel(new GooglePlusPanelView),e.addPanel(new FeedPanelView),e.addPanel(new FeedPanelView({name:"blogger",element:"wc-panel-blogger",inputElement:"wc-panel-blogger-id",template:"http://%s.blogspot.com/feeds/posts/default"})),e.addPanel(new FeedPanelView({name:"tumblr",element:"wc-panel-tumblr",inputElement:"wc-panel-tumblr-id",template:"http://%s.tumblr.com/rss"})),e.addPanel(new FeedPanelView({name:"wordpresscom",element:"wc-panel-wordpresscom",inputElement:"wc-panel-wordpresscom-id",template:"https://%s.wordpress.com/feed/"})),e.addPanel(new FeedPanelView({name:"pixnet",element:"wc-panel-pixnet",inputElement:"wc-panel-pixnet-id",template:"http://%s.pixnet.net/blog/feed/rss"})),e.addPanel(new FeedPanelView({name:"wretchcc",element:"wc-panel-wretchcc",inputElement:"wc-panel-wretchcc-id",template:"http://www.wretch.cc/blog/%s&rss20=1"})),e.addPanel(new FeedPanelView({name:"plurk",element:"wc-panel-plurk",inputElement:"wc-panel-plurk-id",template:"http://www.plurk.com/%s.xml"})),e.addPanel(new FeedPanelView({name:"twitter",element:"wc-panel-twitter",inputElement:"wc-panel-twitter-id",template:"http://twitter.com/statuses/user_timeline/%s.rss"})),e.addPanel(new FeedPanelView({name:"yamblog",element:"wc-panel-yamblog",inputElement:"wc-panel-yamblog-id",template:"http://blog.yam.com/rss.php?blog_id=%s&num=1000"})),a.addFetcher(new TextFetcher),a.addFetcher(new FileFetcher),a.addFetcher(new ListFetcher),a.addFetcher(new FeedFetcher),a.addFetcher(new COSCUPFetcher),a.addFetcher(new WikipediaFetcher),a.addFetcher(new FacebookFetcher),a.addFetcher(new GooglePlusFetcher)}}();